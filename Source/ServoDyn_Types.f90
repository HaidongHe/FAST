!STARTOFREGISTRYGENERATEDFILE './ServoDyn_Types.f90'

! WARNING This file is generated automatically by the FAST registry
! Do not edit.  Your changes to this file will be lost.
!
!*********************************************************************************************************************************
! ServoDyn_Types
!.................................................................................................................................
! LICENSING
! Copyright (C) 2012 National Renewable Energy Laboratory
!
! This file is part of ServoDyn.
!
! ServoDyn is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as
! published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
!
! This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty
! of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
!
! You should have received a copy of the GNU General Public License along with ServoDyn.
! If not, see <http://www.gnu.org/licenses/>.
!
!
! W A R N I N G : This file was automatically generated from the FAST registry.  Changes made to this file may be lost.
!
!*********************************************************************************************************************************
MODULE ServoDyn_Types
! This module contains all of the user-defined types needed in ServoDyn. It also contains copy, destroy, pack, and
! unpack routines associated with each defined data type. This code will be generated by the FAST Registry.
!---------------------------------------------------------------------------------------------------------------------------------
USE NWTC_Library
IMPLICIT NONE
! =========  SrvD_InputFile  =======
  TYPE, PUBLIC :: SrvD_InputFile
    REAL(DbKi)  :: DT 
    INTEGER(IntKi)  :: PCMode 
    REAL(DbKi)  :: TPCOn 
    REAL(DbKi) , DIMENSION(1:3)  :: TPitManS 
    REAL(ReKi) , DIMENSION(1:3)  :: PitManRat 
    REAL(ReKi) , DIMENSION(1:3)  :: BlPitchF 
    INTEGER(IntKi)  :: VSContrl 
    INTEGER(IntKi)  :: GenModel 
    REAL(ReKi)  :: GenEff 
    LOGICAL  :: GenTiStr 
    LOGICAL  :: GenTiStp 
    REAL(ReKi)  :: SpdGenOn 
    REAL(DbKi)  :: TimGenOn 
    REAL(DbKi)  :: TimGenOf 
    REAL(ReKi)  :: VS_RtGnSp 
    REAL(ReKi)  :: VS_RtTq 
    REAL(ReKi)  :: VS_Rgn2K 
    REAL(ReKi)  :: VS_SlPc 
    REAL(ReKi)  :: SIG_SlPc 
    REAL(ReKi)  :: SIG_SySp 
    REAL(ReKi)  :: SIG_RtTq 
    REAL(ReKi)  :: SIG_PORt 
    REAL(ReKi)  :: TEC_Freq 
    INTEGER(IntKi)  :: TEC_NPol 
    REAL(ReKi)  :: TEC_SRes 
    REAL(ReKi)  :: TEC_RRes 
    REAL(ReKi)  :: TEC_VLL 
    REAL(ReKi)  :: TEC_SLR 
    REAL(ReKi)  :: TEC_RLR 
    REAL(ReKi)  :: TEC_MR 
    INTEGER(IntKi)  :: HSSBrMode 
    REAL(DbKi)  :: THSSBrDp 
    REAL(DbKi)  :: HSSBrDT 
    REAL(ReKi)  :: HSSBrTqF 
    INTEGER(IntKi)  :: YCMode 
    REAL(DbKi)  :: TYCOn 
    REAL(ReKi)  :: YawNeut 
    REAL(ReKi)  :: YawSpr 
    REAL(ReKi)  :: YawDamp 
    REAL(DbKi)  :: TYawManS 
    REAL(ReKi)  :: YawManRat 
    REAL(ReKi)  :: NacYawF 
    LOGICAL  :: SumPrint 
    INTEGER(IntKi)  :: OutFile 
    LOGICAL  :: TabDelim 
    CHARACTER(20)  :: OutFmt 
    REAL(DbKi)  :: Tstart 
    INTEGER(IntKi)  :: NumOuts 
    CHARACTER(10) , DIMENSION(:), ALLOCATABLE  :: OutList 
    CHARACTER(1024)  :: DLL_FileName 
    CHARACTER(1024)  :: DLL_ProcName 
    CHARACTER(1024)  :: DLL_InFile 
    REAL(ReKi)  :: NacYaw_North 
    INTEGER(IntKi)  :: Ptch_Cntrl 
    REAL(ReKi)  :: Ptch_SetPnt 
    REAL(ReKi)  :: Ptch_Min 
    REAL(ReKi)  :: Ptch_Max 
    REAL(ReKi)  :: PtchRate_Min 
    REAL(ReKi)  :: PtchRate_Max 
    REAL(ReKi)  :: Gain_OM 
    REAL(ReKi)  :: GenSpd_MinOM 
    REAL(ReKi)  :: GenSpd_MaxOM 
    REAL(ReKi)  :: GenSpd_Dem 
    REAL(ReKi)  :: GenTrq_Dem 
    REAL(ReKi)  :: GenPwr_Dem 
    INTEGER(IntKi)  :: DLL_NumTrq 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: GenSpd_TLU 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: GenTrq_TLU 
  END TYPE SrvD_InputFile
! =======================
! =========  BladedDLLType  =======
  TYPE, PUBLIC :: BladedDLLType
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: avrSWAP 
    REAL(ReKi)  :: HSSBrFrac 
    REAL(ReKi)  :: YawRateCom 
    REAL(ReKi)  :: GenTrq 
    INTEGER(IntKi)  :: GenState 
    REAL(ReKi) , DIMENSION(1:3)  :: BlPitchCom 
  END TYPE BladedDLLType
! =======================
! =========  SrvD_InitInputType  =======
  TYPE, PUBLIC :: SrvD_InitInputType
    CHARACTER(1024)  :: InputFile 
    INTEGER(IntKi)  :: NumBl 
    CHARACTER(1024)  :: RootName 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitchInit 
  END TYPE SrvD_InitInputType
! =======================
! =========  SrvD_InitOutputType  =======
  TYPE, PUBLIC :: SrvD_InitOutputType
    CHARACTER(ChanLen) , DIMENSION(:), ALLOCATABLE  :: WriteOutputHdr 
    CHARACTER(ChanLen) , DIMENSION(:), ALLOCATABLE  :: WriteOutputUnt 
    TYPE(ProgDesc)  :: Ver 
    INTEGER(IntKi)  :: CouplingScheme 
  END TYPE SrvD_InitOutputType
! =======================
! =========  SrvD_ContinuousStateType  =======
  TYPE, PUBLIC :: SrvD_ContinuousStateType
    REAL(ReKi)  :: DummyContState 
  END TYPE SrvD_ContinuousStateType
! =======================
! =========  SrvD_DiscreteStateType  =======
  TYPE, PUBLIC :: SrvD_DiscreteStateType
    REAL(ReKi)  :: DummyDiscState 
  END TYPE SrvD_DiscreteStateType
! =======================
! =========  SrvD_ConstraintStateType  =======
  TYPE, PUBLIC :: SrvD_ConstraintStateType
    REAL(ReKi)  :: DummyConstrState 
  END TYPE SrvD_ConstraintStateType
! =======================
! =========  SrvD_OtherStateType  =======
  TYPE, PUBLIC :: SrvD_OtherStateType
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitchI 
    REAL(DbKi) , DIMENSION(:), ALLOCATABLE  :: BegPitMan 
    REAL(DbKi)  :: BegYawMan 
    REAL(ReKi)  :: NacYawI 
    REAL(ReKi)  :: YawManRat 
    REAL(DbKi)  :: TYawManE 
    REAL(DbKi) , DIMENSION(:), ALLOCATABLE  :: TTpBrDp 
    REAL(DbKi) , DIMENSION(:), ALLOCATABLE  :: TTpBrFl 
    REAL(DbKi) , DIMENSION(:), ALLOCATABLE  :: TPitManE 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: PitManRat 
    REAL(DbKi)  :: TOff4Good 
    REAL(DbKi)  :: TGenOnLine 
    TYPE(BladedDLLType)  :: dll_data 
    REAL(DbKi)  :: LastTimeCalled 
  END TYPE SrvD_OtherStateType
! =======================
! =========  SrvD_ParameterType  =======
  TYPE, PUBLIC :: SrvD_ParameterType
    REAL(DbKi)  :: DT 
    REAL(DbKi)  :: HSSBrDT 
    REAL(ReKi)  :: HSSBrFrac 
    REAL(ReKi)  :: HSSBrTqF 
    REAL(ReKi)  :: SIG_POSl 
    REAL(ReKi)  :: SIG_POTq 
    REAL(ReKi)  :: SIG_SlPc 
    REAL(ReKi)  :: SIG_Slop 
    REAL(ReKi)  :: SIG_SySp 
    REAL(ReKi)  :: TEC_A0 
    REAL(ReKi)  :: TEC_C0 
    REAL(ReKi)  :: TEC_C1 
    REAL(ReKi)  :: TEC_C2 
    REAL(ReKi)  :: TEC_K2 
    REAL(ReKi)  :: TEC_MR 
    REAL(ReKi)  :: TEC_Re1 
    REAL(ReKi)  :: TEC_RLR 
    REAL(ReKi)  :: TEC_RRes 
    REAL(ReKi)  :: TEC_SRes 
    REAL(ReKi)  :: TEC_SySp 
    REAL(ReKi)  :: TEC_V1a 
    REAL(ReKi)  :: TEC_VLL 
    REAL(ReKi)  :: TEC_Xe1 
    REAL(ReKi)  :: GenEff 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitchInit 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitchF 
    REAL(ReKi)  :: NacYawF 
    REAL(ReKi)  :: SpdGenOn 
    REAL(DbKi)  :: THSSBrDp 
    REAL(DbKi)  :: THSSBrFl 
    REAL(DbKi)  :: TimGenOf 
    REAL(DbKi)  :: TimGenOn 
    REAL(DbKi)  :: TPCOn 
    REAL(DbKi) , DIMENSION(:), ALLOCATABLE  :: TPitManS 
    REAL(DbKi)  :: TYawManS 
    REAL(DbKi)  :: TYCOn 
    REAL(ReKi)  :: VS_RtGnSp 
    REAL(ReKi)  :: VS_RtTq 
    REAL(ReKi)  :: VS_Slope 
    REAL(ReKi)  :: VS_SlPc 
    REAL(ReKi)  :: VS_SySp 
    REAL(ReKi)  :: VS_TrGnSp 
    REAL(ReKi)  :: YawPosCom 
    REAL(ReKi)  :: YawRateCom 
    INTEGER(IntKi)  :: GenModel 
    INTEGER(IntKi)  :: HSSBrMode 
    INTEGER(IntKi)  :: PCMode 
    INTEGER(IntKi)  :: VSContrl 
    INTEGER(IntKi)  :: YCMode 
    LOGICAL  :: GenTiStp 
    LOGICAL  :: GenTiStr 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: TBDepISp 
    REAL(ReKi)  :: VS_Rgn2K 
    REAL(ReKi)  :: YawNeut 
    REAL(ReKi)  :: YawSpr 
    REAL(ReKi)  :: YawDamp 
    REAL(DbKi)  :: TpBrDT 
    REAL(ReKi)  :: TBDrConN 
    REAL(ReKi)  :: TBDrConD 
    INTEGER(IntKi)  :: NumBl 
    INTEGER(IntKi)  :: NumOuts 
    CHARACTER(1024)  :: RootName 
    TYPE(OutParmType) , DIMENSION(:), ALLOCATABLE  :: OutParam 
    CHARACTER(1)  :: Delim 
    LOGICAL  :: UseBladedInterface 
    INTEGER(IntKi)  :: DLL_NumTrq 
    INTEGER(IntKi)  :: Ptch_Cntrl 
    REAL(ReKi)  :: Gain_OM 
    REAL(ReKi)  :: GenPwr_Dem 
    REAL(ReKi)  :: GenSpd_Dem 
    REAL(ReKi)  :: GenSpd_MaxOM 
    REAL(ReKi)  :: GenSpd_MinOM 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: GenSpd_TLU 
    REAL(ReKi)  :: GenTrq_Dem 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: GenTrq_TLU 
    REAL(ReKi)  :: Ptch_Max 
    REAL(ReKi)  :: Ptch_Min 
    REAL(ReKi)  :: Ptch_SetPnt 
    REAL(ReKi)  :: PtchRate_Max 
    REAL(ReKi)  :: PtchRate_Min 
    REAL(ReKi)  :: NacYaw_North 
    CHARACTER(1024)  :: DLL_InFile 
  END TYPE SrvD_ParameterType
! =======================
! =========  SrvD_InputType  =======
  TYPE, PUBLIC :: SrvD_InputType
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitch 
    REAL(ReKi)  :: Yaw 
    REAL(ReKi)  :: YawRate 
    REAL(ReKi)  :: LSS_Spd 
    REAL(ReKi)  :: HSS_Spd 
    REAL(ReKi)  :: RotSpeed 
    REAL(ReKi)  :: ExternalYawPosCom 
    REAL(ReKi)  :: ExternalYawRateCom 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: ExternalBlPitchCom 
    REAL(ReKi)  :: ExternalGenTrq 
    REAL(ReKi)  :: ExternalElecPwr 
    REAL(ReKi)  :: ExternalHSSBrFrac 
    REAL(ReKi)  :: TwrAccel 
    REAL(ReKi)  :: YawErr 
    REAL(ReKi)  :: WindDir 
    REAL(ReKi) , DIMENSION(1:3)  :: RootMyc 
    REAL(ReKi)  :: YawBrTAxp 
    REAL(ReKi)  :: YawBrTAyp 
    REAL(ReKi)  :: LSSTipPxa 
    REAL(ReKi) , DIMENSION(1:3)  :: RootMxc 
    REAL(ReKi)  :: LSSTipMya 
    REAL(ReKi)  :: LSSTipMza 
    REAL(ReKi)  :: LSSTipMys 
    REAL(ReKi)  :: LSSTipMzs 
    REAL(ReKi)  :: YawBrMyn 
    REAL(ReKi)  :: YawBrMzn 
    REAL(ReKi)  :: NcIMURAxs 
    REAL(ReKi)  :: NcIMURAys 
    REAL(ReKi)  :: NcIMURAzs 
    REAL(ReKi)  :: RotPwr 
    REAL(ReKi)  :: HorWindV 
    REAL(ReKi)  :: YawAngle 
    REAL(ReKi)  :: ElecPwr_prev 
    REAL(ReKi)  :: GenTrq_prev 
  END TYPE SrvD_InputType
! =======================
! =========  SrvD_OutputType  =======
  TYPE, PUBLIC :: SrvD_OutputType
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: WriteOutput 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: BlPitchCom 
    REAL(ReKi)  :: YawMom 
    REAL(ReKi)  :: GenTrq 
    REAL(ReKi)  :: HSSBrTrq 
    REAL(ReKi)  :: ElecPwr 
    REAL(ReKi) , DIMENSION(:), ALLOCATABLE  :: TBDrCon 
  END TYPE SrvD_OutputType
! =======================
CONTAINS
 SUBROUTINE SrvD_Copyinputfile( SrcinputfileData, DstinputfileData, CtrlCode, ErrStat, ErrMsg )
   TYPE(srvd_inputfile), INTENT(INOUT) :: SrcinputfileData
   TYPE(srvd_inputfile), INTENT(INOUT) :: DstinputfileData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstinputfileData%DT = SrcinputfileData%DT
   DstinputfileData%PCMode = SrcinputfileData%PCMode
   DstinputfileData%TPCOn = SrcinputfileData%TPCOn
   DstinputfileData%TPitManS = SrcinputfileData%TPitManS
   DstinputfileData%PitManRat = SrcinputfileData%PitManRat
   DstinputfileData%BlPitchF = SrcinputfileData%BlPitchF
   DstinputfileData%VSContrl = SrcinputfileData%VSContrl
   DstinputfileData%GenModel = SrcinputfileData%GenModel
   DstinputfileData%GenEff = SrcinputfileData%GenEff
   DstinputfileData%GenTiStr = SrcinputfileData%GenTiStr
   DstinputfileData%GenTiStp = SrcinputfileData%GenTiStp
   DstinputfileData%SpdGenOn = SrcinputfileData%SpdGenOn
   DstinputfileData%TimGenOn = SrcinputfileData%TimGenOn
   DstinputfileData%TimGenOf = SrcinputfileData%TimGenOf
   DstinputfileData%VS_RtGnSp = SrcinputfileData%VS_RtGnSp
   DstinputfileData%VS_RtTq = SrcinputfileData%VS_RtTq
   DstinputfileData%VS_Rgn2K = SrcinputfileData%VS_Rgn2K
   DstinputfileData%VS_SlPc = SrcinputfileData%VS_SlPc
   DstinputfileData%SIG_SlPc = SrcinputfileData%SIG_SlPc
   DstinputfileData%SIG_SySp = SrcinputfileData%SIG_SySp
   DstinputfileData%SIG_RtTq = SrcinputfileData%SIG_RtTq
   DstinputfileData%SIG_PORt = SrcinputfileData%SIG_PORt
   DstinputfileData%TEC_Freq = SrcinputfileData%TEC_Freq
   DstinputfileData%TEC_NPol = SrcinputfileData%TEC_NPol
   DstinputfileData%TEC_SRes = SrcinputfileData%TEC_SRes
   DstinputfileData%TEC_RRes = SrcinputfileData%TEC_RRes
   DstinputfileData%TEC_VLL = SrcinputfileData%TEC_VLL
   DstinputfileData%TEC_SLR = SrcinputfileData%TEC_SLR
   DstinputfileData%TEC_RLR = SrcinputfileData%TEC_RLR
   DstinputfileData%TEC_MR = SrcinputfileData%TEC_MR
   DstinputfileData%HSSBrMode = SrcinputfileData%HSSBrMode
   DstinputfileData%THSSBrDp = SrcinputfileData%THSSBrDp
   DstinputfileData%HSSBrDT = SrcinputfileData%HSSBrDT
   DstinputfileData%HSSBrTqF = SrcinputfileData%HSSBrTqF
   DstinputfileData%YCMode = SrcinputfileData%YCMode
   DstinputfileData%TYCOn = SrcinputfileData%TYCOn
   DstinputfileData%YawNeut = SrcinputfileData%YawNeut
   DstinputfileData%YawSpr = SrcinputfileData%YawSpr
   DstinputfileData%YawDamp = SrcinputfileData%YawDamp
   DstinputfileData%TYawManS = SrcinputfileData%TYawManS
   DstinputfileData%YawManRat = SrcinputfileData%YawManRat
   DstinputfileData%NacYawF = SrcinputfileData%NacYawF
   DstinputfileData%SumPrint = SrcinputfileData%SumPrint
   DstinputfileData%OutFile = SrcinputfileData%OutFile
   DstinputfileData%TabDelim = SrcinputfileData%TabDelim
   DstinputfileData%OutFmt = SrcinputfileData%OutFmt
   DstinputfileData%Tstart = SrcinputfileData%Tstart
   DstinputfileData%NumOuts = SrcinputfileData%NumOuts
IF (ALLOCATED(SrcinputfileData%OutList)) THEN
   i1 = SIZE(SrcinputfileData%OutList,1)
   IF (.NOT.ALLOCATED(DstinputfileData%OutList)) THEN 
      ALLOCATE(DstinputfileData%OutList(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_Copyinputfile: Error allocating DstinputfileData%OutList.'
         RETURN
      END IF
   END IF
   DstinputfileData%OutList = SrcinputfileData%OutList
ENDIF
   DstinputfileData%DLL_FileName = SrcinputfileData%DLL_FileName
   DstinputfileData%DLL_ProcName = SrcinputfileData%DLL_ProcName
   DstinputfileData%DLL_InFile = SrcinputfileData%DLL_InFile
   DstinputfileData%NacYaw_North = SrcinputfileData%NacYaw_North
   DstinputfileData%Ptch_Cntrl = SrcinputfileData%Ptch_Cntrl
   DstinputfileData%Ptch_SetPnt = SrcinputfileData%Ptch_SetPnt
   DstinputfileData%Ptch_Min = SrcinputfileData%Ptch_Min
   DstinputfileData%Ptch_Max = SrcinputfileData%Ptch_Max
   DstinputfileData%PtchRate_Min = SrcinputfileData%PtchRate_Min
   DstinputfileData%PtchRate_Max = SrcinputfileData%PtchRate_Max
   DstinputfileData%Gain_OM = SrcinputfileData%Gain_OM
   DstinputfileData%GenSpd_MinOM = SrcinputfileData%GenSpd_MinOM
   DstinputfileData%GenSpd_MaxOM = SrcinputfileData%GenSpd_MaxOM
   DstinputfileData%GenSpd_Dem = SrcinputfileData%GenSpd_Dem
   DstinputfileData%GenTrq_Dem = SrcinputfileData%GenTrq_Dem
   DstinputfileData%GenPwr_Dem = SrcinputfileData%GenPwr_Dem
   DstinputfileData%DLL_NumTrq = SrcinputfileData%DLL_NumTrq
IF (ALLOCATED(SrcinputfileData%GenSpd_TLU)) THEN
   i1 = SIZE(SrcinputfileData%GenSpd_TLU,1)
   IF (.NOT.ALLOCATED(DstinputfileData%GenSpd_TLU)) THEN 
      ALLOCATE(DstinputfileData%GenSpd_TLU(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_Copyinputfile: Error allocating DstinputfileData%GenSpd_TLU.'
         RETURN
      END IF
   END IF
   DstinputfileData%GenSpd_TLU = SrcinputfileData%GenSpd_TLU
ENDIF
IF (ALLOCATED(SrcinputfileData%GenTrq_TLU)) THEN
   i1 = SIZE(SrcinputfileData%GenTrq_TLU,1)
   IF (.NOT.ALLOCATED(DstinputfileData%GenTrq_TLU)) THEN 
      ALLOCATE(DstinputfileData%GenTrq_TLU(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_Copyinputfile: Error allocating DstinputfileData%GenTrq_TLU.'
         RETURN
      END IF
   END IF
   DstinputfileData%GenTrq_TLU = SrcinputfileData%GenTrq_TLU
ENDIF
 END SUBROUTINE SrvD_Copyinputfile

 SUBROUTINE SrvD_Destroyinputfile( inputfileData, ErrStat, ErrMsg )
  TYPE(srvd_inputfile), INTENT(INOUT) :: inputfileData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(inputfileData%OutList) ) DEALLOCATE(inputfileData%OutList)
  IF ( ALLOCATED(inputfileData%GenSpd_TLU) ) DEALLOCATE(inputfileData%GenSpd_TLU)
  IF ( ALLOCATED(inputfileData%GenTrq_TLU) ) DEALLOCATE(inputfileData%GenTrq_TLU)
 END SUBROUTINE SrvD_Destroyinputfile

 SUBROUTINE SrvD_Packinputfile( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(srvd_inputfile),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Db_BufSz   = Db_BufSz   + 1  ! DT
  Int_BufSz  = Int_BufSz  + 1  ! PCMode
  Db_BufSz   = Db_BufSz   + 1  ! TPCOn
  Db_BufSz    = Db_BufSz    + SIZE( InData%TPitManS )  ! TPitManS 
  Re_BufSz    = Re_BufSz    + SIZE( InData%PitManRat )  ! PitManRat 
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchF )  ! BlPitchF 
  Int_BufSz  = Int_BufSz  + 1  ! VSContrl
  Int_BufSz  = Int_BufSz  + 1  ! GenModel
  Re_BufSz   = Re_BufSz   + 1  ! GenEff
  Re_BufSz   = Re_BufSz   + 1  ! SpdGenOn
  Db_BufSz   = Db_BufSz   + 1  ! TimGenOn
  Db_BufSz   = Db_BufSz   + 1  ! TimGenOf
  Re_BufSz   = Re_BufSz   + 1  ! VS_RtGnSp
  Re_BufSz   = Re_BufSz   + 1  ! VS_RtTq
  Re_BufSz   = Re_BufSz   + 1  ! VS_Rgn2K
  Re_BufSz   = Re_BufSz   + 1  ! VS_SlPc
  Re_BufSz   = Re_BufSz   + 1  ! SIG_SlPc
  Re_BufSz   = Re_BufSz   + 1  ! SIG_SySp
  Re_BufSz   = Re_BufSz   + 1  ! SIG_RtTq
  Re_BufSz   = Re_BufSz   + 1  ! SIG_PORt
  Re_BufSz   = Re_BufSz   + 1  ! TEC_Freq
  Int_BufSz  = Int_BufSz  + 1  ! TEC_NPol
  Re_BufSz   = Re_BufSz   + 1  ! TEC_SRes
  Re_BufSz   = Re_BufSz   + 1  ! TEC_RRes
  Re_BufSz   = Re_BufSz   + 1  ! TEC_VLL
  Re_BufSz   = Re_BufSz   + 1  ! TEC_SLR
  Re_BufSz   = Re_BufSz   + 1  ! TEC_RLR
  Re_BufSz   = Re_BufSz   + 1  ! TEC_MR
  Int_BufSz  = Int_BufSz  + 1  ! HSSBrMode
  Db_BufSz   = Db_BufSz   + 1  ! THSSBrDp
  Db_BufSz   = Db_BufSz   + 1  ! HSSBrDT
  Re_BufSz   = Re_BufSz   + 1  ! HSSBrTqF
  Int_BufSz  = Int_BufSz  + 1  ! YCMode
  Db_BufSz   = Db_BufSz   + 1  ! TYCOn
  Re_BufSz   = Re_BufSz   + 1  ! YawNeut
  Re_BufSz   = Re_BufSz   + 1  ! YawSpr
  Re_BufSz   = Re_BufSz   + 1  ! YawDamp
  Db_BufSz   = Db_BufSz   + 1  ! TYawManS
  Re_BufSz   = Re_BufSz   + 1  ! YawManRat
  Re_BufSz   = Re_BufSz   + 1  ! NacYawF
  Int_BufSz  = Int_BufSz  + 1  ! OutFile
  Db_BufSz   = Db_BufSz   + 1  ! Tstart
  Int_BufSz  = Int_BufSz  + 1  ! NumOuts
  Re_BufSz   = Re_BufSz   + 1  ! NacYaw_North
  Int_BufSz  = Int_BufSz  + 1  ! Ptch_Cntrl
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_SetPnt
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_Min
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_Max
  Re_BufSz   = Re_BufSz   + 1  ! PtchRate_Min
  Re_BufSz   = Re_BufSz   + 1  ! PtchRate_Max
  Re_BufSz   = Re_BufSz   + 1  ! Gain_OM
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_MinOM
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_MaxOM
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_Dem
  Re_BufSz   = Re_BufSz   + 1  ! GenTrq_Dem
  Re_BufSz   = Re_BufSz   + 1  ! GenPwr_Dem
  Int_BufSz  = Int_BufSz  + 1  ! DLL_NumTrq
  Re_BufSz    = Re_BufSz    + SIZE( InData%GenSpd_TLU )  ! GenSpd_TLU 
  Re_BufSz    = Re_BufSz    + SIZE( InData%GenTrq_TLU )  ! GenTrq_TLU 
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%DT )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%PCMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TPCOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%TPitManS))-1 ) =  PACK(InData%TPitManS ,.TRUE.)
  Db_Xferred   = Db_Xferred   + SIZE(InData%TPitManS)
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%PitManRat))-1 ) =  PACK(InData%PitManRat ,.TRUE.)
  Re_Xferred   = Re_Xferred   + SIZE(InData%PitManRat)
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchF))-1 ) =  PACK(InData%BlPitchF ,.TRUE.)
  Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchF)
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%VSContrl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%GenModel )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenEff )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SpdGenOn )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TimGenOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TimGenOf )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_RtGnSp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_RtTq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_Rgn2K )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_SlPc )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_SlPc )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_SySp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_RtTq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_PORt )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_Freq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%TEC_NPol )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_SRes )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_RRes )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_VLL )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_SLR )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_RLR )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_MR )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%HSSBrMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%THSSBrDp )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%HSSBrDT )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSSBrTqF )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%YCMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TYCOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawNeut )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawSpr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawDamp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TYawManS )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawManRat )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NacYawF )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%OutFile )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%Tstart )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%NumOuts )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NacYaw_North )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%Ptch_Cntrl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_SetPnt )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_Min )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_Max )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%PtchRate_Min )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%PtchRate_Max )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Gain_OM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_MinOM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_MaxOM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenTrq_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenPwr_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%DLL_NumTrq )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(InData%GenSpd_TLU) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%GenSpd_TLU))-1 ) =  PACK(InData%GenSpd_TLU ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%GenSpd_TLU)
  ENDIF
  IF ( ALLOCATED(InData%GenTrq_TLU) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%GenTrq_TLU))-1 ) =  PACK(InData%GenTrq_TLU ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%GenTrq_TLU)
  ENDIF
 END SUBROUTINE SrvD_Packinputfile

 SUBROUTINE SrvD_UnPackinputfile( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(srvd_inputfile), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%DT = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%PCMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%TPCOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  ALLOCATE(mask1(SIZE(OutData%TPitManS,1))); mask1 = .TRUE.
  OutData%TPitManS = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%TPitManS))-1 ),mask1,OutData%TPitManS)
  DEALLOCATE(mask1)
  Db_Xferred   = Db_Xferred   + SIZE(OutData%TPitManS)
  ALLOCATE(mask1(SIZE(OutData%PitManRat,1))); mask1 = .TRUE.
  OutData%PitManRat = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%PitManRat))-1 ),mask1,OutData%PitManRat)
  DEALLOCATE(mask1)
  Re_Xferred   = Re_Xferred   + SIZE(OutData%PitManRat)
  ALLOCATE(mask1(SIZE(OutData%BlPitchF,1))); mask1 = .TRUE.
  OutData%BlPitchF = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchF))-1 ),mask1,OutData%BlPitchF)
  DEALLOCATE(mask1)
  Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchF)
  OutData%VSContrl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%GenModel = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%GenEff = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SpdGenOn = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TimGenOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TimGenOf = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%VS_RtGnSp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_RtTq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_Rgn2K = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_SlPc = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_SlPc = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_SySp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_RtTq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_PORt = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_Freq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_NPol = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%TEC_SRes = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_RRes = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_VLL = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_SLR = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_RLR = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_MR = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%HSSBrMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%THSSBrDp = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%HSSBrDT = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%HSSBrTqF = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YCMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%TYCOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%YawNeut = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawSpr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawDamp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TYawManS = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%YawManRat = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NacYawF = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%OutFile = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%Tstart = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%NumOuts = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%NacYaw_North = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Ptch_Cntrl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%Ptch_SetPnt = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Ptch_Min = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Ptch_Max = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%PtchRate_Min = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%PtchRate_Max = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Gain_OM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_MinOM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_MaxOM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenTrq_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenPwr_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%DLL_NumTrq = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(OutData%GenSpd_TLU) ) THEN
  ALLOCATE(mask1(SIZE(OutData%GenSpd_TLU,1))); mask1 = .TRUE.
    OutData%GenSpd_TLU = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%GenSpd_TLU))-1 ),mask1,OutData%GenSpd_TLU)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%GenSpd_TLU)
  ENDIF
  IF ( ALLOCATED(OutData%GenTrq_TLU) ) THEN
  ALLOCATE(mask1(SIZE(OutData%GenTrq_TLU,1))); mask1 = .TRUE.
    OutData%GenTrq_TLU = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%GenTrq_TLU))-1 ),mask1,OutData%GenTrq_TLU)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%GenTrq_TLU)
  ENDIF
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackinputfile

 SUBROUTINE SrvD_Copybladeddlltype( SrcbladeddlltypeData, DstbladeddlltypeData, CtrlCode, ErrStat, ErrMsg )
   TYPE(bladeddlltype), INTENT(INOUT) :: SrcbladeddlltypeData
   TYPE(bladeddlltype), INTENT(INOUT) :: DstbladeddlltypeData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
IF (ALLOCATED(SrcbladeddlltypeData%avrSWAP)) THEN
   i1 = SIZE(SrcbladeddlltypeData%avrSWAP,1)
   IF (.NOT.ALLOCATED(DstbladeddlltypeData%avrSWAP)) THEN 
      ALLOCATE(DstbladeddlltypeData%avrSWAP(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_Copybladeddlltype: Error allocating DstbladeddlltypeData%avrSWAP.'
         RETURN
      END IF
   END IF
   DstbladeddlltypeData%avrSWAP = SrcbladeddlltypeData%avrSWAP
ENDIF
   DstbladeddlltypeData%HSSBrFrac = SrcbladeddlltypeData%HSSBrFrac
   DstbladeddlltypeData%YawRateCom = SrcbladeddlltypeData%YawRateCom
   DstbladeddlltypeData%GenTrq = SrcbladeddlltypeData%GenTrq
   DstbladeddlltypeData%GenState = SrcbladeddlltypeData%GenState
   DstbladeddlltypeData%BlPitchCom = SrcbladeddlltypeData%BlPitchCom
 END SUBROUTINE SrvD_Copybladeddlltype

 SUBROUTINE SrvD_Destroybladeddlltype( bladeddlltypeData, ErrStat, ErrMsg )
  TYPE(bladeddlltype), INTENT(INOUT) :: bladeddlltypeData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(bladeddlltypeData%avrSWAP) ) DEALLOCATE(bladeddlltypeData%avrSWAP)
 END SUBROUTINE SrvD_Destroybladeddlltype

 SUBROUTINE SrvD_Packbladeddlltype( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(bladeddlltype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz    = Re_BufSz    + SIZE( InData%avrSWAP )  ! avrSWAP 
  Re_BufSz   = Re_BufSz   + 1  ! HSSBrFrac
  Re_BufSz   = Re_BufSz   + 1  ! YawRateCom
  Re_BufSz   = Re_BufSz   + 1  ! GenTrq
  Int_BufSz  = Int_BufSz  + 1  ! GenState
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchCom )  ! BlPitchCom 
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( ALLOCATED(InData%avrSWAP) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%avrSWAP))-1 ) =  PACK(InData%avrSWAP ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%avrSWAP)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSSBrFrac )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawRateCom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenTrq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%GenState )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchCom))-1 ) =  PACK(InData%BlPitchCom ,.TRUE.)
  Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchCom)
 END SUBROUTINE SrvD_Packbladeddlltype

 SUBROUTINE SrvD_UnPackbladeddlltype( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(bladeddlltype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  IF ( ALLOCATED(OutData%avrSWAP) ) THEN
  ALLOCATE(mask1(SIZE(OutData%avrSWAP,1))); mask1 = .TRUE.
    OutData%avrSWAP = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%avrSWAP))-1 ),mask1,OutData%avrSWAP)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%avrSWAP)
  ENDIF
  OutData%HSSBrFrac = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawRateCom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenTrq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenState = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  ALLOCATE(mask1(SIZE(OutData%BlPitchCom,1))); mask1 = .TRUE.
  OutData%BlPitchCom = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchCom))-1 ),mask1,OutData%BlPitchCom)
  DEALLOCATE(mask1)
  Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchCom)
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackbladeddlltype

 SUBROUTINE SrvD_CopyInitInput( SrcInitInputData, DstInitInputData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_initinputtype), INTENT(INOUT) :: SrcInitInputData
   TYPE(SrvD_initinputtype), INTENT(INOUT) :: DstInitInputData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstInitInputData%InputFile = SrcInitInputData%InputFile
   DstInitInputData%NumBl = SrcInitInputData%NumBl
   DstInitInputData%RootName = SrcInitInputData%RootName
IF (ALLOCATED(SrcInitInputData%BlPitchInit)) THEN
   i1 = SIZE(SrcInitInputData%BlPitchInit,1)
   IF (.NOT.ALLOCATED(DstInitInputData%BlPitchInit)) THEN 
      ALLOCATE(DstInitInputData%BlPitchInit(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyInitInput: Error allocating DstInitInputData%BlPitchInit.'
         RETURN
      END IF
   END IF
   DstInitInputData%BlPitchInit = SrcInitInputData%BlPitchInit
ENDIF
 END SUBROUTINE SrvD_CopyInitInput

 SUBROUTINE SrvD_DestroyInitInput( InitInputData, ErrStat, ErrMsg )
  TYPE(SrvD_initinputtype), INTENT(INOUT) :: InitInputData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(InitInputData%BlPitchInit) ) DEALLOCATE(InitInputData%BlPitchInit)
 END SUBROUTINE SrvD_DestroyInitInput

 SUBROUTINE SrvD_PackInitInput( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_initinputtype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Int_BufSz  = Int_BufSz  + 1  ! NumBl
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchInit )  ! BlPitchInit 
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%NumBl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(InData%BlPitchInit) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchInit))-1 ) =  PACK(InData%BlPitchInit ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchInit)
  ENDIF
 END SUBROUTINE SrvD_PackInitInput

 SUBROUTINE SrvD_UnPackInitInput( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_initinputtype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%NumBl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(OutData%BlPitchInit) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitchInit,1))); mask1 = .TRUE.
    OutData%BlPitchInit = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchInit))-1 ),mask1,OutData%BlPitchInit)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchInit)
  ENDIF
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackInitInput

 SUBROUTINE SrvD_CopyInitOutput( SrcInitOutputData, DstInitOutputData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_initoutputtype), INTENT(INOUT) :: SrcInitOutputData
   TYPE(SrvD_initoutputtype), INTENT(INOUT) :: DstInitOutputData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
IF (ALLOCATED(SrcInitOutputData%WriteOutputHdr)) THEN
   i1 = SIZE(SrcInitOutputData%WriteOutputHdr,1)
   IF (.NOT.ALLOCATED(DstInitOutputData%WriteOutputHdr)) THEN 
      ALLOCATE(DstInitOutputData%WriteOutputHdr(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyInitOutput: Error allocating DstInitOutputData%WriteOutputHdr.'
         RETURN
      END IF
   END IF
   DstInitOutputData%WriteOutputHdr = SrcInitOutputData%WriteOutputHdr
ENDIF
IF (ALLOCATED(SrcInitOutputData%WriteOutputUnt)) THEN
   i1 = SIZE(SrcInitOutputData%WriteOutputUnt,1)
   IF (.NOT.ALLOCATED(DstInitOutputData%WriteOutputUnt)) THEN 
      ALLOCATE(DstInitOutputData%WriteOutputUnt(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyInitOutput: Error allocating DstInitOutputData%WriteOutputUnt.'
         RETURN
      END IF
   END IF
   DstInitOutputData%WriteOutputUnt = SrcInitOutputData%WriteOutputUnt
ENDIF
      CALL NWTC_Library_Copyprogdesc( SrcInitOutputData%Ver, DstInitOutputData%Ver, CtrlCode, ErrStat, ErrMsg )
   DstInitOutputData%CouplingScheme = SrcInitOutputData%CouplingScheme
 END SUBROUTINE SrvD_CopyInitOutput

 SUBROUTINE SrvD_DestroyInitOutput( InitOutputData, ErrStat, ErrMsg )
  TYPE(SrvD_initoutputtype), INTENT(INOUT) :: InitOutputData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(InitOutputData%WriteOutputHdr) ) DEALLOCATE(InitOutputData%WriteOutputHdr)
  IF ( ALLOCATED(InitOutputData%WriteOutputUnt) ) DEALLOCATE(InitOutputData%WriteOutputUnt)
  CALL NWTC_Library_Destroyprogdesc( InitOutputData%Ver, ErrStat, ErrMsg )
 END SUBROUTINE SrvD_DestroyInitOutput

 SUBROUTINE SrvD_PackInitOutput( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_initoutputtype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  REAL(ReKi),     ALLOCATABLE :: Re_Ver_Buf(:)
  REAL(DbKi),     ALLOCATABLE :: Db_Ver_Buf(:)
  INTEGER(IntKi), ALLOCATABLE :: Int_Ver_Buf(:)
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  CALL NWTC_Library_Packprogdesc( Re_Ver_Buf, Db_Ver_Buf, Int_Ver_Buf, InData%Ver, ErrStat, ErrMsg, .TRUE. ) ! Ver 
  IF(ALLOCATED(Re_Ver_Buf)) Re_BufSz  = Re_BufSz  + SIZE( Re_Ver_Buf  ) ! Ver
  IF(ALLOCATED(Db_Ver_Buf)) Db_BufSz  = Db_BufSz  + SIZE( Db_Ver_Buf  ) ! Ver
  IF(ALLOCATED(Int_Ver_Buf))Int_BufSz = Int_BufSz + SIZE( Int_Ver_Buf ) ! Ver
  IF(ALLOCATED(Re_Ver_Buf))  DEALLOCATE(Re_Ver_Buf)
  IF(ALLOCATED(Db_Ver_Buf))  DEALLOCATE(Db_Ver_Buf)
  IF(ALLOCATED(Int_Ver_Buf)) DEALLOCATE(Int_Ver_Buf)
  Int_BufSz  = Int_BufSz  + 1  ! CouplingScheme
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  CALL NWTC_Library_Packprogdesc( Re_Ver_Buf, Db_Ver_Buf, Int_Ver_Buf, InData%Ver, ErrStat, ErrMsg, OnlySize ) ! Ver 
  IF(ALLOCATED(Re_Ver_Buf)) THEN
    IF ( .NOT. OnlySize ) ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_Ver_Buf)-1 ) = Re_Ver_Buf
    Re_Xferred = Re_Xferred + SIZE(Re_Ver_Buf)
  ENDIF
  IF(ALLOCATED(Db_Ver_Buf)) THEN
    IF ( .NOT. OnlySize ) DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_Ver_Buf)-1 ) = Db_Ver_Buf
    Db_Xferred = Db_Xferred + SIZE(Db_Ver_Buf)
  ENDIF
  IF(ALLOCATED(Int_Ver_Buf)) THEN
    IF ( .NOT. OnlySize ) IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_Ver_Buf)-1 ) = Int_Ver_Buf
    Int_Xferred = Int_Xferred + SIZE(Int_Ver_Buf)
  ENDIF
  IF( ALLOCATED(Re_Ver_Buf) )  DEALLOCATE(Re_Ver_Buf)
  IF( ALLOCATED(Db_Ver_Buf) )  DEALLOCATE(Db_Ver_Buf)
  IF( ALLOCATED(Int_Ver_Buf) ) DEALLOCATE(Int_Ver_Buf)
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%CouplingScheme )
  Int_Xferred   = Int_Xferred   + 1
 END SUBROUTINE SrvD_PackInitOutput

 SUBROUTINE SrvD_UnPackInitOutput( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_initoutputtype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
  REAL(ReKi),    ALLOCATABLE :: Re_Ver_Buf(:)
  REAL(DbKi),    ALLOCATABLE :: Db_Ver_Buf(:)
  INTEGER(IntKi),    ALLOCATABLE :: Int_Ver_Buf(:)
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
 ! first call NWTC_Library_Packprogdesc to get correctly sized buffers for unpacking
  CALL NWTC_Library_Packprogdesc( Re_Ver_Buf, Db_Ver_Buf, Int_Ver_Buf, OutData%Ver, ErrStat, ErrMsg, .TRUE. ) ! Ver 
  IF(ALLOCATED(Re_Ver_Buf)) THEN
    Re_Ver_Buf = ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_Ver_Buf)-1 )
    Re_Xferred = Re_Xferred + SIZE(Re_Ver_Buf)
  ENDIF
  IF(ALLOCATED(Db_Ver_Buf)) THEN
    Db_Ver_Buf = DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_Ver_Buf)-1 )
    Db_Xferred = Db_Xferred + SIZE(Db_Ver_Buf)
  ENDIF
  IF(ALLOCATED(Int_Ver_Buf)) THEN
    Int_Ver_Buf = IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_Ver_Buf)-1 )
    Int_Xferred = Int_Xferred + SIZE(Int_Ver_Buf)
  ENDIF
  CALL NWTC_Library_UnPackprogdesc( Re_Ver_Buf, Db_Ver_Buf, Int_Ver_Buf, OutData%Ver, ErrStat, ErrMsg ) ! Ver 
  OutData%CouplingScheme = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackInitOutput

 SUBROUTINE SrvD_CopyContState( SrcContStateData, DstContStateData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_continuousstatetype), INTENT(INOUT) :: SrcContStateData
   TYPE(SrvD_continuousstatetype), INTENT(INOUT) :: DstContStateData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstContStateData%DummyContState = SrcContStateData%DummyContState
 END SUBROUTINE SrvD_CopyContState

 SUBROUTINE SrvD_DestroyContState( ContStateData, ErrStat, ErrMsg )
  TYPE(SrvD_continuousstatetype), INTENT(INOUT) :: ContStateData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
 END SUBROUTINE SrvD_DestroyContState

 SUBROUTINE SrvD_PackContState( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_continuousstatetype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz   = Re_BufSz   + 1  ! DummyContState
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%DummyContState )
  Re_Xferred   = Re_Xferred   + 1
 END SUBROUTINE SrvD_PackContState

 SUBROUTINE SrvD_UnPackContState( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_continuousstatetype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%DummyContState = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackContState

 SUBROUTINE SrvD_CopyDiscState( SrcDiscStateData, DstDiscStateData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_discretestatetype), INTENT(INOUT) :: SrcDiscStateData
   TYPE(SrvD_discretestatetype), INTENT(INOUT) :: DstDiscStateData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstDiscStateData%DummyDiscState = SrcDiscStateData%DummyDiscState
 END SUBROUTINE SrvD_CopyDiscState

 SUBROUTINE SrvD_DestroyDiscState( DiscStateData, ErrStat, ErrMsg )
  TYPE(SrvD_discretestatetype), INTENT(INOUT) :: DiscStateData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
 END SUBROUTINE SrvD_DestroyDiscState

 SUBROUTINE SrvD_PackDiscState( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_discretestatetype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz   = Re_BufSz   + 1  ! DummyDiscState
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%DummyDiscState )
  Re_Xferred   = Re_Xferred   + 1
 END SUBROUTINE SrvD_PackDiscState

 SUBROUTINE SrvD_UnPackDiscState( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_discretestatetype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%DummyDiscState = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackDiscState

 SUBROUTINE SrvD_CopyConstrState( SrcConstrStateData, DstConstrStateData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_constraintstatetype), INTENT(INOUT) :: SrcConstrStateData
   TYPE(SrvD_constraintstatetype), INTENT(INOUT) :: DstConstrStateData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstConstrStateData%DummyConstrState = SrcConstrStateData%DummyConstrState
 END SUBROUTINE SrvD_CopyConstrState

 SUBROUTINE SrvD_DestroyConstrState( ConstrStateData, ErrStat, ErrMsg )
  TYPE(SrvD_constraintstatetype), INTENT(INOUT) :: ConstrStateData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
 END SUBROUTINE SrvD_DestroyConstrState

 SUBROUTINE SrvD_PackConstrState( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_constraintstatetype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz   = Re_BufSz   + 1  ! DummyConstrState
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%DummyConstrState )
  Re_Xferred   = Re_Xferred   + 1
 END SUBROUTINE SrvD_PackConstrState

 SUBROUTINE SrvD_UnPackConstrState( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_constraintstatetype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%DummyConstrState = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackConstrState

 SUBROUTINE SrvD_CopyOtherState( SrcOtherStateData, DstOtherStateData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_otherstatetype), INTENT(INOUT) :: SrcOtherStateData
   TYPE(SrvD_otherstatetype), INTENT(INOUT) :: DstOtherStateData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
IF (ALLOCATED(SrcOtherStateData%BlPitchI)) THEN
   i1 = SIZE(SrcOtherStateData%BlPitchI,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%BlPitchI)) THEN 
      ALLOCATE(DstOtherStateData%BlPitchI(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%BlPitchI.'
         RETURN
      END IF
   END IF
   DstOtherStateData%BlPitchI = SrcOtherStateData%BlPitchI
ENDIF
IF (ALLOCATED(SrcOtherStateData%BegPitMan)) THEN
   i1 = SIZE(SrcOtherStateData%BegPitMan,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%BegPitMan)) THEN 
      ALLOCATE(DstOtherStateData%BegPitMan(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%BegPitMan.'
         RETURN
      END IF
   END IF
   DstOtherStateData%BegPitMan = SrcOtherStateData%BegPitMan
ENDIF
   DstOtherStateData%BegYawMan = SrcOtherStateData%BegYawMan
   DstOtherStateData%NacYawI = SrcOtherStateData%NacYawI
   DstOtherStateData%YawManRat = SrcOtherStateData%YawManRat
   DstOtherStateData%TYawManE = SrcOtherStateData%TYawManE
IF (ALLOCATED(SrcOtherStateData%TTpBrDp)) THEN
   i1 = SIZE(SrcOtherStateData%TTpBrDp,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%TTpBrDp)) THEN 
      ALLOCATE(DstOtherStateData%TTpBrDp(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%TTpBrDp.'
         RETURN
      END IF
   END IF
   DstOtherStateData%TTpBrDp = SrcOtherStateData%TTpBrDp
ENDIF
IF (ALLOCATED(SrcOtherStateData%TTpBrFl)) THEN
   i1 = SIZE(SrcOtherStateData%TTpBrFl,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%TTpBrFl)) THEN 
      ALLOCATE(DstOtherStateData%TTpBrFl(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%TTpBrFl.'
         RETURN
      END IF
   END IF
   DstOtherStateData%TTpBrFl = SrcOtherStateData%TTpBrFl
ENDIF
IF (ALLOCATED(SrcOtherStateData%TPitManE)) THEN
   i1 = SIZE(SrcOtherStateData%TPitManE,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%TPitManE)) THEN 
      ALLOCATE(DstOtherStateData%TPitManE(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%TPitManE.'
         RETURN
      END IF
   END IF
   DstOtherStateData%TPitManE = SrcOtherStateData%TPitManE
ENDIF
IF (ALLOCATED(SrcOtherStateData%PitManRat)) THEN
   i1 = SIZE(SrcOtherStateData%PitManRat,1)
   IF (.NOT.ALLOCATED(DstOtherStateData%PitManRat)) THEN 
      ALLOCATE(DstOtherStateData%PitManRat(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOtherState: Error allocating DstOtherStateData%PitManRat.'
         RETURN
      END IF
   END IF
   DstOtherStateData%PitManRat = SrcOtherStateData%PitManRat
ENDIF
   DstOtherStateData%TOff4Good = SrcOtherStateData%TOff4Good
   DstOtherStateData%TGenOnLine = SrcOtherStateData%TGenOnLine
      CALL SrvD_Copybladeddlltype( SrcOtherStateData%dll_data, DstOtherStateData%dll_data, CtrlCode, ErrStat, ErrMsg )
   DstOtherStateData%LastTimeCalled = SrcOtherStateData%LastTimeCalled
 END SUBROUTINE SrvD_CopyOtherState

 SUBROUTINE SrvD_DestroyOtherState( OtherStateData, ErrStat, ErrMsg )
  TYPE(SrvD_otherstatetype), INTENT(INOUT) :: OtherStateData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(OtherStateData%BlPitchI) ) DEALLOCATE(OtherStateData%BlPitchI)
  IF ( ALLOCATED(OtherStateData%BegPitMan) ) DEALLOCATE(OtherStateData%BegPitMan)
  IF ( ALLOCATED(OtherStateData%TTpBrDp) ) DEALLOCATE(OtherStateData%TTpBrDp)
  IF ( ALLOCATED(OtherStateData%TTpBrFl) ) DEALLOCATE(OtherStateData%TTpBrFl)
  IF ( ALLOCATED(OtherStateData%TPitManE) ) DEALLOCATE(OtherStateData%TPitManE)
  IF ( ALLOCATED(OtherStateData%PitManRat) ) DEALLOCATE(OtherStateData%PitManRat)
  CALL SrvD_Destroybladeddlltype( OtherStateData%dll_data, ErrStat, ErrMsg )
 END SUBROUTINE SrvD_DestroyOtherState

 SUBROUTINE SrvD_PackOtherState( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_otherstatetype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  REAL(ReKi),     ALLOCATABLE :: Re_dll_data_Buf(:)
  REAL(DbKi),     ALLOCATABLE :: Db_dll_data_Buf(:)
  INTEGER(IntKi), ALLOCATABLE :: Int_dll_data_Buf(:)
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchI )  ! BlPitchI 
  Db_BufSz    = Db_BufSz    + SIZE( InData%BegPitMan )  ! BegPitMan 
  Db_BufSz   = Db_BufSz   + 1  ! BegYawMan
  Re_BufSz   = Re_BufSz   + 1  ! NacYawI
  Re_BufSz   = Re_BufSz   + 1  ! YawManRat
  Db_BufSz   = Db_BufSz   + 1  ! TYawManE
  Db_BufSz    = Db_BufSz    + SIZE( InData%TTpBrDp )  ! TTpBrDp 
  Db_BufSz    = Db_BufSz    + SIZE( InData%TTpBrFl )  ! TTpBrFl 
  Db_BufSz    = Db_BufSz    + SIZE( InData%TPitManE )  ! TPitManE 
  Re_BufSz    = Re_BufSz    + SIZE( InData%PitManRat )  ! PitManRat 
  Db_BufSz   = Db_BufSz   + 1  ! TOff4Good
  Db_BufSz   = Db_BufSz   + 1  ! TGenOnLine
  CALL SrvD_Packbladeddlltype( Re_dll_data_Buf, Db_dll_data_Buf, Int_dll_data_Buf, InData%dll_data, ErrStat, ErrMsg, .TRUE. ) ! dll_data 
  IF(ALLOCATED(Re_dll_data_Buf)) Re_BufSz  = Re_BufSz  + SIZE( Re_dll_data_Buf  ) ! dll_data
  IF(ALLOCATED(Db_dll_data_Buf)) Db_BufSz  = Db_BufSz  + SIZE( Db_dll_data_Buf  ) ! dll_data
  IF(ALLOCATED(Int_dll_data_Buf))Int_BufSz = Int_BufSz + SIZE( Int_dll_data_Buf ) ! dll_data
  IF(ALLOCATED(Re_dll_data_Buf))  DEALLOCATE(Re_dll_data_Buf)
  IF(ALLOCATED(Db_dll_data_Buf))  DEALLOCATE(Db_dll_data_Buf)
  IF(ALLOCATED(Int_dll_data_Buf)) DEALLOCATE(Int_dll_data_Buf)
  Db_BufSz   = Db_BufSz   + 1  ! LastTimeCalled
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( ALLOCATED(InData%BlPitchI) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchI))-1 ) =  PACK(InData%BlPitchI ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchI)
  ENDIF
  IF ( ALLOCATED(InData%BegPitMan) ) THEN
    IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%BegPitMan))-1 ) =  PACK(InData%BegPitMan ,.TRUE.)
    Db_Xferred   = Db_Xferred   + SIZE(InData%BegPitMan)
  ENDIF
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%BegYawMan )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NacYawI )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawManRat )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TYawManE )
  Db_Xferred   = Db_Xferred   + 1
  IF ( ALLOCATED(InData%TTpBrDp) ) THEN
    IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%TTpBrDp))-1 ) =  PACK(InData%TTpBrDp ,.TRUE.)
    Db_Xferred   = Db_Xferred   + SIZE(InData%TTpBrDp)
  ENDIF
  IF ( ALLOCATED(InData%TTpBrFl) ) THEN
    IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%TTpBrFl))-1 ) =  PACK(InData%TTpBrFl ,.TRUE.)
    Db_Xferred   = Db_Xferred   + SIZE(InData%TTpBrFl)
  ENDIF
  IF ( ALLOCATED(InData%TPitManE) ) THEN
    IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%TPitManE))-1 ) =  PACK(InData%TPitManE ,.TRUE.)
    Db_Xferred   = Db_Xferred   + SIZE(InData%TPitManE)
  ENDIF
  IF ( ALLOCATED(InData%PitManRat) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%PitManRat))-1 ) =  PACK(InData%PitManRat ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%PitManRat)
  ENDIF
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TOff4Good )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TGenOnLine )
  Db_Xferred   = Db_Xferred   + 1
  CALL SrvD_Packbladeddlltype( Re_dll_data_Buf, Db_dll_data_Buf, Int_dll_data_Buf, InData%dll_data, ErrStat, ErrMsg, OnlySize ) ! dll_data 
  IF(ALLOCATED(Re_dll_data_Buf)) THEN
    IF ( .NOT. OnlySize ) ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_dll_data_Buf)-1 ) = Re_dll_data_Buf
    Re_Xferred = Re_Xferred + SIZE(Re_dll_data_Buf)
  ENDIF
  IF(ALLOCATED(Db_dll_data_Buf)) THEN
    IF ( .NOT. OnlySize ) DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_dll_data_Buf)-1 ) = Db_dll_data_Buf
    Db_Xferred = Db_Xferred + SIZE(Db_dll_data_Buf)
  ENDIF
  IF(ALLOCATED(Int_dll_data_Buf)) THEN
    IF ( .NOT. OnlySize ) IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_dll_data_Buf)-1 ) = Int_dll_data_Buf
    Int_Xferred = Int_Xferred + SIZE(Int_dll_data_Buf)
  ENDIF
  IF( ALLOCATED(Re_dll_data_Buf) )  DEALLOCATE(Re_dll_data_Buf)
  IF( ALLOCATED(Db_dll_data_Buf) )  DEALLOCATE(Db_dll_data_Buf)
  IF( ALLOCATED(Int_dll_data_Buf) ) DEALLOCATE(Int_dll_data_Buf)
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%LastTimeCalled )
  Db_Xferred   = Db_Xferred   + 1
 END SUBROUTINE SrvD_PackOtherState

 SUBROUTINE SrvD_UnPackOtherState( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_otherstatetype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
  REAL(ReKi),    ALLOCATABLE :: Re_dll_data_Buf(:)
  REAL(DbKi),    ALLOCATABLE :: Db_dll_data_Buf(:)
  INTEGER(IntKi),    ALLOCATABLE :: Int_dll_data_Buf(:)
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  IF ( ALLOCATED(OutData%BlPitchI) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitchI,1))); mask1 = .TRUE.
    OutData%BlPitchI = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchI))-1 ),mask1,OutData%BlPitchI)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchI)
  ENDIF
  IF ( ALLOCATED(OutData%BegPitMan) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BegPitMan,1))); mask1 = .TRUE.
    OutData%BegPitMan = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%BegPitMan))-1 ),mask1,OutData%BegPitMan)
  DEALLOCATE(mask1)
    Db_Xferred   = Db_Xferred   + SIZE(OutData%BegPitMan)
  ENDIF
  OutData%BegYawMan = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%NacYawI = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawManRat = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TYawManE = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  IF ( ALLOCATED(OutData%TTpBrDp) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TTpBrDp,1))); mask1 = .TRUE.
    OutData%TTpBrDp = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%TTpBrDp))-1 ),mask1,OutData%TTpBrDp)
  DEALLOCATE(mask1)
    Db_Xferred   = Db_Xferred   + SIZE(OutData%TTpBrDp)
  ENDIF
  IF ( ALLOCATED(OutData%TTpBrFl) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TTpBrFl,1))); mask1 = .TRUE.
    OutData%TTpBrFl = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%TTpBrFl))-1 ),mask1,OutData%TTpBrFl)
  DEALLOCATE(mask1)
    Db_Xferred   = Db_Xferred   + SIZE(OutData%TTpBrFl)
  ENDIF
  IF ( ALLOCATED(OutData%TPitManE) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TPitManE,1))); mask1 = .TRUE.
    OutData%TPitManE = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%TPitManE))-1 ),mask1,OutData%TPitManE)
  DEALLOCATE(mask1)
    Db_Xferred   = Db_Xferred   + SIZE(OutData%TPitManE)
  ENDIF
  IF ( ALLOCATED(OutData%PitManRat) ) THEN
  ALLOCATE(mask1(SIZE(OutData%PitManRat,1))); mask1 = .TRUE.
    OutData%PitManRat = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%PitManRat))-1 ),mask1,OutData%PitManRat)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%PitManRat)
  ENDIF
  OutData%TOff4Good = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TGenOnLine = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
 ! first call SrvD_Packbladeddlltype to get correctly sized buffers for unpacking
  CALL SrvD_Packbladeddlltype( Re_dll_data_Buf, Db_dll_data_Buf, Int_dll_data_Buf, OutData%dll_data, ErrStat, ErrMsg, .TRUE. ) ! dll_data 
  IF(ALLOCATED(Re_dll_data_Buf)) THEN
    Re_dll_data_Buf = ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_dll_data_Buf)-1 )
    Re_Xferred = Re_Xferred + SIZE(Re_dll_data_Buf)
  ENDIF
  IF(ALLOCATED(Db_dll_data_Buf)) THEN
    Db_dll_data_Buf = DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_dll_data_Buf)-1 )
    Db_Xferred = Db_Xferred + SIZE(Db_dll_data_Buf)
  ENDIF
  IF(ALLOCATED(Int_dll_data_Buf)) THEN
    Int_dll_data_Buf = IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_dll_data_Buf)-1 )
    Int_Xferred = Int_Xferred + SIZE(Int_dll_data_Buf)
  ENDIF
  CALL SrvD_UnPackbladeddlltype( Re_dll_data_Buf, Db_dll_data_Buf, Int_dll_data_Buf, OutData%dll_data, ErrStat, ErrMsg ) ! dll_data 
  OutData%LastTimeCalled = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackOtherState

 SUBROUTINE SrvD_CopyParam( SrcParamData, DstParamData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_parametertype), INTENT(INOUT) :: SrcParamData
   TYPE(SrvD_parametertype), INTENT(INOUT) :: DstParamData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
   DstParamData%DT = SrcParamData%DT
   DstParamData%HSSBrDT = SrcParamData%HSSBrDT
   DstParamData%HSSBrFrac = SrcParamData%HSSBrFrac
   DstParamData%HSSBrTqF = SrcParamData%HSSBrTqF
   DstParamData%SIG_POSl = SrcParamData%SIG_POSl
   DstParamData%SIG_POTq = SrcParamData%SIG_POTq
   DstParamData%SIG_SlPc = SrcParamData%SIG_SlPc
   DstParamData%SIG_Slop = SrcParamData%SIG_Slop
   DstParamData%SIG_SySp = SrcParamData%SIG_SySp
   DstParamData%TEC_A0 = SrcParamData%TEC_A0
   DstParamData%TEC_C0 = SrcParamData%TEC_C0
   DstParamData%TEC_C1 = SrcParamData%TEC_C1
   DstParamData%TEC_C2 = SrcParamData%TEC_C2
   DstParamData%TEC_K2 = SrcParamData%TEC_K2
   DstParamData%TEC_MR = SrcParamData%TEC_MR
   DstParamData%TEC_Re1 = SrcParamData%TEC_Re1
   DstParamData%TEC_RLR = SrcParamData%TEC_RLR
   DstParamData%TEC_RRes = SrcParamData%TEC_RRes
   DstParamData%TEC_SRes = SrcParamData%TEC_SRes
   DstParamData%TEC_SySp = SrcParamData%TEC_SySp
   DstParamData%TEC_V1a = SrcParamData%TEC_V1a
   DstParamData%TEC_VLL = SrcParamData%TEC_VLL
   DstParamData%TEC_Xe1 = SrcParamData%TEC_Xe1
   DstParamData%GenEff = SrcParamData%GenEff
IF (ALLOCATED(SrcParamData%BlPitchInit)) THEN
   i1 = SIZE(SrcParamData%BlPitchInit,1)
   IF (.NOT.ALLOCATED(DstParamData%BlPitchInit)) THEN 
      ALLOCATE(DstParamData%BlPitchInit(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%BlPitchInit.'
         RETURN
      END IF
   END IF
   DstParamData%BlPitchInit = SrcParamData%BlPitchInit
ENDIF
IF (ALLOCATED(SrcParamData%BlPitchF)) THEN
   i1 = SIZE(SrcParamData%BlPitchF,1)
   IF (.NOT.ALLOCATED(DstParamData%BlPitchF)) THEN 
      ALLOCATE(DstParamData%BlPitchF(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%BlPitchF.'
         RETURN
      END IF
   END IF
   DstParamData%BlPitchF = SrcParamData%BlPitchF
ENDIF
   DstParamData%NacYawF = SrcParamData%NacYawF
   DstParamData%SpdGenOn = SrcParamData%SpdGenOn
   DstParamData%THSSBrDp = SrcParamData%THSSBrDp
   DstParamData%THSSBrFl = SrcParamData%THSSBrFl
   DstParamData%TimGenOf = SrcParamData%TimGenOf
   DstParamData%TimGenOn = SrcParamData%TimGenOn
   DstParamData%TPCOn = SrcParamData%TPCOn
IF (ALLOCATED(SrcParamData%TPitManS)) THEN
   i1 = SIZE(SrcParamData%TPitManS,1)
   IF (.NOT.ALLOCATED(DstParamData%TPitManS)) THEN 
      ALLOCATE(DstParamData%TPitManS(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%TPitManS.'
         RETURN
      END IF
   END IF
   DstParamData%TPitManS = SrcParamData%TPitManS
ENDIF
   DstParamData%TYawManS = SrcParamData%TYawManS
   DstParamData%TYCOn = SrcParamData%TYCOn
   DstParamData%VS_RtGnSp = SrcParamData%VS_RtGnSp
   DstParamData%VS_RtTq = SrcParamData%VS_RtTq
   DstParamData%VS_Slope = SrcParamData%VS_Slope
   DstParamData%VS_SlPc = SrcParamData%VS_SlPc
   DstParamData%VS_SySp = SrcParamData%VS_SySp
   DstParamData%VS_TrGnSp = SrcParamData%VS_TrGnSp
   DstParamData%YawPosCom = SrcParamData%YawPosCom
   DstParamData%YawRateCom = SrcParamData%YawRateCom
   DstParamData%GenModel = SrcParamData%GenModel
   DstParamData%HSSBrMode = SrcParamData%HSSBrMode
   DstParamData%PCMode = SrcParamData%PCMode
   DstParamData%VSContrl = SrcParamData%VSContrl
   DstParamData%YCMode = SrcParamData%YCMode
   DstParamData%GenTiStp = SrcParamData%GenTiStp
   DstParamData%GenTiStr = SrcParamData%GenTiStr
IF (ALLOCATED(SrcParamData%TBDepISp)) THEN
   i1 = SIZE(SrcParamData%TBDepISp,1)
   IF (.NOT.ALLOCATED(DstParamData%TBDepISp)) THEN 
      ALLOCATE(DstParamData%TBDepISp(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%TBDepISp.'
         RETURN
      END IF
   END IF
   DstParamData%TBDepISp = SrcParamData%TBDepISp
ENDIF
   DstParamData%VS_Rgn2K = SrcParamData%VS_Rgn2K
   DstParamData%YawNeut = SrcParamData%YawNeut
   DstParamData%YawSpr = SrcParamData%YawSpr
   DstParamData%YawDamp = SrcParamData%YawDamp
   DstParamData%TpBrDT = SrcParamData%TpBrDT
   DstParamData%TBDrConN = SrcParamData%TBDrConN
   DstParamData%TBDrConD = SrcParamData%TBDrConD
   DstParamData%NumBl = SrcParamData%NumBl
   DstParamData%NumOuts = SrcParamData%NumOuts
   DstParamData%RootName = SrcParamData%RootName
IF (ALLOCATED(SrcParamData%OutParam)) THEN
   i1 = SIZE(SrcParamData%OutParam,1)
   IF (.NOT.ALLOCATED(DstParamData%OutParam)) THEN 
      ALLOCATE(DstParamData%OutParam(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%OutParam.'
         RETURN
      END IF
   END IF
   DO i1 = 1, SIZE(SrcParamData%OutParam,1)
      CALL NWTC_Library_Copyoutparmtype( SrcParamData%OutParam(i1), DstParamData%OutParam(i1), CtrlCode, ErrStat, ErrMsg )
   ENDDO
ENDIF
   DstParamData%Delim = SrcParamData%Delim
   DstParamData%UseBladedInterface = SrcParamData%UseBladedInterface
   DstParamData%DLL_NumTrq = SrcParamData%DLL_NumTrq
   DstParamData%Ptch_Cntrl = SrcParamData%Ptch_Cntrl
   DstParamData%Gain_OM = SrcParamData%Gain_OM
   DstParamData%GenPwr_Dem = SrcParamData%GenPwr_Dem
   DstParamData%GenSpd_Dem = SrcParamData%GenSpd_Dem
   DstParamData%GenSpd_MaxOM = SrcParamData%GenSpd_MaxOM
   DstParamData%GenSpd_MinOM = SrcParamData%GenSpd_MinOM
IF (ALLOCATED(SrcParamData%GenSpd_TLU)) THEN
   i1 = SIZE(SrcParamData%GenSpd_TLU,1)
   IF (.NOT.ALLOCATED(DstParamData%GenSpd_TLU)) THEN 
      ALLOCATE(DstParamData%GenSpd_TLU(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%GenSpd_TLU.'
         RETURN
      END IF
   END IF
   DstParamData%GenSpd_TLU = SrcParamData%GenSpd_TLU
ENDIF
   DstParamData%GenTrq_Dem = SrcParamData%GenTrq_Dem
IF (ALLOCATED(SrcParamData%GenTrq_TLU)) THEN
   i1 = SIZE(SrcParamData%GenTrq_TLU,1)
   IF (.NOT.ALLOCATED(DstParamData%GenTrq_TLU)) THEN 
      ALLOCATE(DstParamData%GenTrq_TLU(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyParam: Error allocating DstParamData%GenTrq_TLU.'
         RETURN
      END IF
   END IF
   DstParamData%GenTrq_TLU = SrcParamData%GenTrq_TLU
ENDIF
   DstParamData%Ptch_Max = SrcParamData%Ptch_Max
   DstParamData%Ptch_Min = SrcParamData%Ptch_Min
   DstParamData%Ptch_SetPnt = SrcParamData%Ptch_SetPnt
   DstParamData%PtchRate_Max = SrcParamData%PtchRate_Max
   DstParamData%PtchRate_Min = SrcParamData%PtchRate_Min
   DstParamData%NacYaw_North = SrcParamData%NacYaw_North
   DstParamData%DLL_InFile = SrcParamData%DLL_InFile
 END SUBROUTINE SrvD_CopyParam

 SUBROUTINE SrvD_DestroyParam( ParamData, ErrStat, ErrMsg )
  TYPE(SrvD_parametertype), INTENT(INOUT) :: ParamData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(ParamData%BlPitchInit) ) DEALLOCATE(ParamData%BlPitchInit)
  IF ( ALLOCATED(ParamData%BlPitchF) ) DEALLOCATE(ParamData%BlPitchF)
  IF ( ALLOCATED(ParamData%TPitManS) ) DEALLOCATE(ParamData%TPitManS)
  IF ( ALLOCATED(ParamData%TBDepISp) ) DEALLOCATE(ParamData%TBDepISp)
IF (ALLOCATED(ParamData%OutParam)) THEN
DO i1 = 1, SIZE(ParamData%OutParam,1)
  CALL NWTC_Library_Destroyoutparmtype( ParamData%OutParam(i1), ErrStat, ErrMsg )
ENDDO
ENDIF
  IF ( ALLOCATED(ParamData%GenSpd_TLU) ) DEALLOCATE(ParamData%GenSpd_TLU)
  IF ( ALLOCATED(ParamData%GenTrq_TLU) ) DEALLOCATE(ParamData%GenTrq_TLU)
 END SUBROUTINE SrvD_DestroyParam

 SUBROUTINE SrvD_PackParam( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_parametertype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  REAL(ReKi),     ALLOCATABLE :: Re_OutParam_Buf(:)
  REAL(DbKi),     ALLOCATABLE :: Db_OutParam_Buf(:)
  INTEGER(IntKi), ALLOCATABLE :: Int_OutParam_Buf(:)
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Db_BufSz   = Db_BufSz   + 1  ! DT
  Db_BufSz   = Db_BufSz   + 1  ! HSSBrDT
  Re_BufSz   = Re_BufSz   + 1  ! HSSBrFrac
  Re_BufSz   = Re_BufSz   + 1  ! HSSBrTqF
  Re_BufSz   = Re_BufSz   + 1  ! SIG_POSl
  Re_BufSz   = Re_BufSz   + 1  ! SIG_POTq
  Re_BufSz   = Re_BufSz   + 1  ! SIG_SlPc
  Re_BufSz   = Re_BufSz   + 1  ! SIG_Slop
  Re_BufSz   = Re_BufSz   + 1  ! SIG_SySp
  Re_BufSz   = Re_BufSz   + 1  ! TEC_A0
  Re_BufSz   = Re_BufSz   + 1  ! TEC_C0
  Re_BufSz   = Re_BufSz   + 1  ! TEC_C1
  Re_BufSz   = Re_BufSz   + 1  ! TEC_C2
  Re_BufSz   = Re_BufSz   + 1  ! TEC_K2
  Re_BufSz   = Re_BufSz   + 1  ! TEC_MR
  Re_BufSz   = Re_BufSz   + 1  ! TEC_Re1
  Re_BufSz   = Re_BufSz   + 1  ! TEC_RLR
  Re_BufSz   = Re_BufSz   + 1  ! TEC_RRes
  Re_BufSz   = Re_BufSz   + 1  ! TEC_SRes
  Re_BufSz   = Re_BufSz   + 1  ! TEC_SySp
  Re_BufSz   = Re_BufSz   + 1  ! TEC_V1a
  Re_BufSz   = Re_BufSz   + 1  ! TEC_VLL
  Re_BufSz   = Re_BufSz   + 1  ! TEC_Xe1
  Re_BufSz   = Re_BufSz   + 1  ! GenEff
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchInit )  ! BlPitchInit 
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchF )  ! BlPitchF 
  Re_BufSz   = Re_BufSz   + 1  ! NacYawF
  Re_BufSz   = Re_BufSz   + 1  ! SpdGenOn
  Db_BufSz   = Db_BufSz   + 1  ! THSSBrDp
  Db_BufSz   = Db_BufSz   + 1  ! THSSBrFl
  Db_BufSz   = Db_BufSz   + 1  ! TimGenOf
  Db_BufSz   = Db_BufSz   + 1  ! TimGenOn
  Db_BufSz   = Db_BufSz   + 1  ! TPCOn
  Db_BufSz    = Db_BufSz    + SIZE( InData%TPitManS )  ! TPitManS 
  Db_BufSz   = Db_BufSz   + 1  ! TYawManS
  Db_BufSz   = Db_BufSz   + 1  ! TYCOn
  Re_BufSz   = Re_BufSz   + 1  ! VS_RtGnSp
  Re_BufSz   = Re_BufSz   + 1  ! VS_RtTq
  Re_BufSz   = Re_BufSz   + 1  ! VS_Slope
  Re_BufSz   = Re_BufSz   + 1  ! VS_SlPc
  Re_BufSz   = Re_BufSz   + 1  ! VS_SySp
  Re_BufSz   = Re_BufSz   + 1  ! VS_TrGnSp
  Re_BufSz   = Re_BufSz   + 1  ! YawPosCom
  Re_BufSz   = Re_BufSz   + 1  ! YawRateCom
  Int_BufSz  = Int_BufSz  + 1  ! GenModel
  Int_BufSz  = Int_BufSz  + 1  ! HSSBrMode
  Int_BufSz  = Int_BufSz  + 1  ! PCMode
  Int_BufSz  = Int_BufSz  + 1  ! VSContrl
  Int_BufSz  = Int_BufSz  + 1  ! YCMode
  Re_BufSz    = Re_BufSz    + SIZE( InData%TBDepISp )  ! TBDepISp 
  Re_BufSz   = Re_BufSz   + 1  ! VS_Rgn2K
  Re_BufSz   = Re_BufSz   + 1  ! YawNeut
  Re_BufSz   = Re_BufSz   + 1  ! YawSpr
  Re_BufSz   = Re_BufSz   + 1  ! YawDamp
  Db_BufSz   = Db_BufSz   + 1  ! TpBrDT
  Re_BufSz   = Re_BufSz   + 1  ! TBDrConN
  Re_BufSz   = Re_BufSz   + 1  ! TBDrConD
  Int_BufSz  = Int_BufSz  + 1  ! NumBl
  Int_BufSz  = Int_BufSz  + 1  ! NumOuts
DO i1 = 1, SIZE(InData%OutParam,1)
  CALL NWTC_Library_Packoutparmtype( Re_OutParam_Buf, Db_OutParam_Buf, Int_OutParam_Buf, InData%OutParam(i1), ErrStat, ErrMsg, .TRUE. ) ! OutParam 
  IF(ALLOCATED(Re_OutParam_Buf)) Re_BufSz  = Re_BufSz  + SIZE( Re_OutParam_Buf  ) ! OutParam
  IF(ALLOCATED(Db_OutParam_Buf)) Db_BufSz  = Db_BufSz  + SIZE( Db_OutParam_Buf  ) ! OutParam
  IF(ALLOCATED(Int_OutParam_Buf))Int_BufSz = Int_BufSz + SIZE( Int_OutParam_Buf ) ! OutParam
  IF(ALLOCATED(Re_OutParam_Buf))  DEALLOCATE(Re_OutParam_Buf)
  IF(ALLOCATED(Db_OutParam_Buf))  DEALLOCATE(Db_OutParam_Buf)
  IF(ALLOCATED(Int_OutParam_Buf)) DEALLOCATE(Int_OutParam_Buf)
ENDDO
  Int_BufSz  = Int_BufSz  + 1  ! DLL_NumTrq
  Int_BufSz  = Int_BufSz  + 1  ! Ptch_Cntrl
  Re_BufSz   = Re_BufSz   + 1  ! Gain_OM
  Re_BufSz   = Re_BufSz   + 1  ! GenPwr_Dem
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_Dem
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_MaxOM
  Re_BufSz   = Re_BufSz   + 1  ! GenSpd_MinOM
  Re_BufSz    = Re_BufSz    + SIZE( InData%GenSpd_TLU )  ! GenSpd_TLU 
  Re_BufSz   = Re_BufSz   + 1  ! GenTrq_Dem
  Re_BufSz    = Re_BufSz    + SIZE( InData%GenTrq_TLU )  ! GenTrq_TLU 
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_Max
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_Min
  Re_BufSz   = Re_BufSz   + 1  ! Ptch_SetPnt
  Re_BufSz   = Re_BufSz   + 1  ! PtchRate_Max
  Re_BufSz   = Re_BufSz   + 1  ! PtchRate_Min
  Re_BufSz   = Re_BufSz   + 1  ! NacYaw_North
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%DT )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%HSSBrDT )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSSBrFrac )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSSBrTqF )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_POSl )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_POTq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_SlPc )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_Slop )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SIG_SySp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_A0 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_C0 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_C1 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_C2 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_K2 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_MR )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_Re1 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_RLR )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_RRes )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_SRes )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_SySp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_V1a )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_VLL )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TEC_Xe1 )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenEff )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(InData%BlPitchInit) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchInit))-1 ) =  PACK(InData%BlPitchInit ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchInit)
  ENDIF
  IF ( ALLOCATED(InData%BlPitchF) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchF))-1 ) =  PACK(InData%BlPitchF ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchF)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NacYawF )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%SpdGenOn )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%THSSBrDp )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%THSSBrFl )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TimGenOf )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TimGenOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TPCOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( ALLOCATED(InData%TPitManS) ) THEN
    IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(SIZE(InData%TPitManS))-1 ) =  PACK(InData%TPitManS ,.TRUE.)
    Db_Xferred   = Db_Xferred   + SIZE(InData%TPitManS)
  ENDIF
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TYawManS )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TYCOn )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_RtGnSp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_RtTq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_Slope )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_SlPc )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_SySp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_TrGnSp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawPosCom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawRateCom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%GenModel )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%HSSBrMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%PCMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%VSContrl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%YCMode )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(InData%TBDepISp) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%TBDepISp))-1 ) =  PACK(InData%TBDepISp ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%TBDepISp)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%VS_Rgn2K )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawNeut )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawSpr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawDamp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) DbKiBuf ( Db_Xferred:Db_Xferred+(1)-1 ) =  (InData%TpBrDT )
  Db_Xferred   = Db_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TBDrConN )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TBDrConD )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%NumBl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%NumOuts )
  Int_Xferred   = Int_Xferred   + 1
DO i1 = 1, SIZE(InData%OutParam,1)
  CALL NWTC_Library_Packoutparmtype( Re_OutParam_Buf, Db_OutParam_Buf, Int_OutParam_Buf, InData%OutParam(i1), ErrStat, ErrMsg, OnlySize ) ! OutParam 
  IF(ALLOCATED(Re_OutParam_Buf)) THEN
    IF ( .NOT. OnlySize ) ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_OutParam_Buf)-1 ) = Re_OutParam_Buf
    Re_Xferred = Re_Xferred + SIZE(Re_OutParam_Buf)
  ENDIF
  IF(ALLOCATED(Db_OutParam_Buf)) THEN
    IF ( .NOT. OnlySize ) DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_OutParam_Buf)-1 ) = Db_OutParam_Buf
    Db_Xferred = Db_Xferred + SIZE(Db_OutParam_Buf)
  ENDIF
  IF(ALLOCATED(Int_OutParam_Buf)) THEN
    IF ( .NOT. OnlySize ) IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_OutParam_Buf)-1 ) = Int_OutParam_Buf
    Int_Xferred = Int_Xferred + SIZE(Int_OutParam_Buf)
  ENDIF
  IF( ALLOCATED(Re_OutParam_Buf) )  DEALLOCATE(Re_OutParam_Buf)
  IF( ALLOCATED(Db_OutParam_Buf) )  DEALLOCATE(Db_OutParam_Buf)
  IF( ALLOCATED(Int_OutParam_Buf) ) DEALLOCATE(Int_OutParam_Buf)
ENDDO
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%DLL_NumTrq )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) IntKiBuf ( Int_Xferred:Int_Xferred+(1)-1 ) = (InData%Ptch_Cntrl )
  Int_Xferred   = Int_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Gain_OM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenPwr_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_MaxOM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenSpd_MinOM )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(InData%GenSpd_TLU) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%GenSpd_TLU))-1 ) =  PACK(InData%GenSpd_TLU ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%GenSpd_TLU)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenTrq_Dem )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(InData%GenTrq_TLU) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%GenTrq_TLU))-1 ) =  PACK(InData%GenTrq_TLU ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%GenTrq_TLU)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_Max )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_Min )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Ptch_SetPnt )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%PtchRate_Max )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%PtchRate_Min )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NacYaw_North )
  Re_Xferred   = Re_Xferred   + 1
 END SUBROUTINE SrvD_PackParam

 SUBROUTINE SrvD_UnPackParam( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_parametertype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
  REAL(ReKi),    ALLOCATABLE :: Re_OutParam_Buf(:)
  REAL(DbKi),    ALLOCATABLE :: Db_OutParam_Buf(:)
  INTEGER(IntKi),    ALLOCATABLE :: Int_OutParam_Buf(:)
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  OutData%DT = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%HSSBrDT = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%HSSBrFrac = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%HSSBrTqF = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_POSl = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_POTq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_SlPc = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_Slop = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SIG_SySp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_A0 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_C0 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_C1 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_C2 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_K2 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_MR = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_Re1 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_RLR = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_RRes = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_SRes = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_SySp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_V1a = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_VLL = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TEC_Xe1 = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenEff = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(OutData%BlPitchInit) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitchInit,1))); mask1 = .TRUE.
    OutData%BlPitchInit = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchInit))-1 ),mask1,OutData%BlPitchInit)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchInit)
  ENDIF
  IF ( ALLOCATED(OutData%BlPitchF) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitchF,1))); mask1 = .TRUE.
    OutData%BlPitchF = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchF))-1 ),mask1,OutData%BlPitchF)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchF)
  ENDIF
  OutData%NacYawF = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%SpdGenOn = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%THSSBrDp = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%THSSBrFl = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TimGenOf = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TimGenOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TPCOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  IF ( ALLOCATED(OutData%TPitManS) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TPitManS,1))); mask1 = .TRUE.
    OutData%TPitManS = UNPACK(DbKiBuf( Db_Xferred:Re_Xferred+(SIZE(OutData%TPitManS))-1 ),mask1,OutData%TPitManS)
  DEALLOCATE(mask1)
    Db_Xferred   = Db_Xferred   + SIZE(OutData%TPitManS)
  ENDIF
  OutData%TYawManS = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TYCOn = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%VS_RtGnSp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_RtTq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_Slope = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_SlPc = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_SySp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%VS_TrGnSp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawPosCom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawRateCom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenModel = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%HSSBrMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%PCMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%VSContrl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%YCMode = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  IF ( ALLOCATED(OutData%TBDepISp) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TBDepISp,1))); mask1 = .TRUE.
    OutData%TBDepISp = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%TBDepISp))-1 ),mask1,OutData%TBDepISp)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%TBDepISp)
  ENDIF
  OutData%VS_Rgn2K = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawNeut = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawSpr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawDamp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TpBrDT = DbKiBuf ( Db_Xferred )
  Db_Xferred   = Db_Xferred   + 1
  OutData%TBDrConN = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TBDrConD = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NumBl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%NumOuts = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
DO i1 = 1, SIZE(OutData%OutParam,1)
 ! first call NWTC_Library_Packoutparmtype to get correctly sized buffers for unpacking
  CALL NWTC_Library_Packoutparmtype( Re_OutParam_Buf, Db_OutParam_Buf, Int_OutParam_Buf, OutData%OutParam(i1), ErrStat, ErrMsg, .TRUE. ) ! OutParam 
  IF(ALLOCATED(Re_OutParam_Buf)) THEN
    Re_OutParam_Buf = ReKiBuf( Re_Xferred:Re_Xferred+SIZE(Re_OutParam_Buf)-1 )
    Re_Xferred = Re_Xferred + SIZE(Re_OutParam_Buf)
  ENDIF
  IF(ALLOCATED(Db_OutParam_Buf)) THEN
    Db_OutParam_Buf = DbKiBuf( Db_Xferred:Db_Xferred+SIZE(Db_OutParam_Buf)-1 )
    Db_Xferred = Db_Xferred + SIZE(Db_OutParam_Buf)
  ENDIF
  IF(ALLOCATED(Int_OutParam_Buf)) THEN
    Int_OutParam_Buf = IntKiBuf( Int_Xferred:Int_Xferred+SIZE(Int_OutParam_Buf)-1 )
    Int_Xferred = Int_Xferred + SIZE(Int_OutParam_Buf)
  ENDIF
  CALL NWTC_Library_UnPackoutparmtype( Re_OutParam_Buf, Db_OutParam_Buf, Int_OutParam_Buf, OutData%OutParam(i1), ErrStat, ErrMsg ) ! OutParam 
ENDDO
  OutData%DLL_NumTrq = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%Ptch_Cntrl = IntKiBuf ( Int_Xferred )
  Int_Xferred   = Int_Xferred   + 1
  OutData%Gain_OM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenPwr_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_MaxOM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenSpd_MinOM = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(OutData%GenSpd_TLU) ) THEN
  ALLOCATE(mask1(SIZE(OutData%GenSpd_TLU,1))); mask1 = .TRUE.
    OutData%GenSpd_TLU = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%GenSpd_TLU))-1 ),mask1,OutData%GenSpd_TLU)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%GenSpd_TLU)
  ENDIF
  OutData%GenTrq_Dem = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(OutData%GenTrq_TLU) ) THEN
  ALLOCATE(mask1(SIZE(OutData%GenTrq_TLU,1))); mask1 = .TRUE.
    OutData%GenTrq_TLU = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%GenTrq_TLU))-1 ),mask1,OutData%GenTrq_TLU)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%GenTrq_TLU)
  ENDIF
  OutData%Ptch_Max = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Ptch_Min = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%Ptch_SetPnt = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%PtchRate_Max = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%PtchRate_Min = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NacYaw_North = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackParam

 SUBROUTINE SrvD_CopyInput( SrcInputData, DstInputData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_inputtype), INTENT(INOUT) :: SrcInputData
   TYPE(SrvD_inputtype), INTENT(INOUT) :: DstInputData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
IF (ALLOCATED(SrcInputData%BlPitch)) THEN
   i1 = SIZE(SrcInputData%BlPitch,1)
   IF (.NOT.ALLOCATED(DstInputData%BlPitch)) THEN 
      ALLOCATE(DstInputData%BlPitch(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyInput: Error allocating DstInputData%BlPitch.'
         RETURN
      END IF
   END IF
   DstInputData%BlPitch = SrcInputData%BlPitch
ENDIF
   DstInputData%Yaw = SrcInputData%Yaw
   DstInputData%YawRate = SrcInputData%YawRate
   DstInputData%LSS_Spd = SrcInputData%LSS_Spd
   DstInputData%HSS_Spd = SrcInputData%HSS_Spd
   DstInputData%RotSpeed = SrcInputData%RotSpeed
   DstInputData%ExternalYawPosCom = SrcInputData%ExternalYawPosCom
   DstInputData%ExternalYawRateCom = SrcInputData%ExternalYawRateCom
IF (ALLOCATED(SrcInputData%ExternalBlPitchCom)) THEN
   i1 = SIZE(SrcInputData%ExternalBlPitchCom,1)
   IF (.NOT.ALLOCATED(DstInputData%ExternalBlPitchCom)) THEN 
      ALLOCATE(DstInputData%ExternalBlPitchCom(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyInput: Error allocating DstInputData%ExternalBlPitchCom.'
         RETURN
      END IF
   END IF
   DstInputData%ExternalBlPitchCom = SrcInputData%ExternalBlPitchCom
ENDIF
   DstInputData%ExternalGenTrq = SrcInputData%ExternalGenTrq
   DstInputData%ExternalElecPwr = SrcInputData%ExternalElecPwr
   DstInputData%ExternalHSSBrFrac = SrcInputData%ExternalHSSBrFrac
   DstInputData%TwrAccel = SrcInputData%TwrAccel
   DstInputData%YawErr = SrcInputData%YawErr
   DstInputData%WindDir = SrcInputData%WindDir
   DstInputData%RootMyc = SrcInputData%RootMyc
   DstInputData%YawBrTAxp = SrcInputData%YawBrTAxp
   DstInputData%YawBrTAyp = SrcInputData%YawBrTAyp
   DstInputData%LSSTipPxa = SrcInputData%LSSTipPxa
   DstInputData%RootMxc = SrcInputData%RootMxc
   DstInputData%LSSTipMya = SrcInputData%LSSTipMya
   DstInputData%LSSTipMza = SrcInputData%LSSTipMza
   DstInputData%LSSTipMys = SrcInputData%LSSTipMys
   DstInputData%LSSTipMzs = SrcInputData%LSSTipMzs
   DstInputData%YawBrMyn = SrcInputData%YawBrMyn
   DstInputData%YawBrMzn = SrcInputData%YawBrMzn
   DstInputData%NcIMURAxs = SrcInputData%NcIMURAxs
   DstInputData%NcIMURAys = SrcInputData%NcIMURAys
   DstInputData%NcIMURAzs = SrcInputData%NcIMURAzs
   DstInputData%RotPwr = SrcInputData%RotPwr
   DstInputData%HorWindV = SrcInputData%HorWindV
   DstInputData%YawAngle = SrcInputData%YawAngle
   DstInputData%ElecPwr_prev = SrcInputData%ElecPwr_prev
   DstInputData%GenTrq_prev = SrcInputData%GenTrq_prev
 END SUBROUTINE SrvD_CopyInput

 SUBROUTINE SrvD_DestroyInput( InputData, ErrStat, ErrMsg )
  TYPE(SrvD_inputtype), INTENT(INOUT) :: InputData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(InputData%BlPitch) ) DEALLOCATE(InputData%BlPitch)
  IF ( ALLOCATED(InputData%ExternalBlPitchCom) ) DEALLOCATE(InputData%ExternalBlPitchCom)
 END SUBROUTINE SrvD_DestroyInput

 SUBROUTINE SrvD_PackInput( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_inputtype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitch )  ! BlPitch 
  Re_BufSz   = Re_BufSz   + 1  ! Yaw
  Re_BufSz   = Re_BufSz   + 1  ! YawRate
  Re_BufSz   = Re_BufSz   + 1  ! LSS_Spd
  Re_BufSz   = Re_BufSz   + 1  ! HSS_Spd
  Re_BufSz   = Re_BufSz   + 1  ! RotSpeed
  Re_BufSz   = Re_BufSz   + 1  ! ExternalYawPosCom
  Re_BufSz   = Re_BufSz   + 1  ! ExternalYawRateCom
  Re_BufSz    = Re_BufSz    + SIZE( InData%ExternalBlPitchCom )  ! ExternalBlPitchCom 
  Re_BufSz   = Re_BufSz   + 1  ! ExternalGenTrq
  Re_BufSz   = Re_BufSz   + 1  ! ExternalElecPwr
  Re_BufSz   = Re_BufSz   + 1  ! ExternalHSSBrFrac
  Re_BufSz   = Re_BufSz   + 1  ! TwrAccel
  Re_BufSz   = Re_BufSz   + 1  ! YawErr
  Re_BufSz   = Re_BufSz   + 1  ! WindDir
  Re_BufSz    = Re_BufSz    + SIZE( InData%RootMyc )  ! RootMyc 
  Re_BufSz   = Re_BufSz   + 1  ! YawBrTAxp
  Re_BufSz   = Re_BufSz   + 1  ! YawBrTAyp
  Re_BufSz   = Re_BufSz   + 1  ! LSSTipPxa
  Re_BufSz    = Re_BufSz    + SIZE( InData%RootMxc )  ! RootMxc 
  Re_BufSz   = Re_BufSz   + 1  ! LSSTipMya
  Re_BufSz   = Re_BufSz   + 1  ! LSSTipMza
  Re_BufSz   = Re_BufSz   + 1  ! LSSTipMys
  Re_BufSz   = Re_BufSz   + 1  ! LSSTipMzs
  Re_BufSz   = Re_BufSz   + 1  ! YawBrMyn
  Re_BufSz   = Re_BufSz   + 1  ! YawBrMzn
  Re_BufSz   = Re_BufSz   + 1  ! NcIMURAxs
  Re_BufSz   = Re_BufSz   + 1  ! NcIMURAys
  Re_BufSz   = Re_BufSz   + 1  ! NcIMURAzs
  Re_BufSz   = Re_BufSz   + 1  ! RotPwr
  Re_BufSz   = Re_BufSz   + 1  ! HorWindV
  Re_BufSz   = Re_BufSz   + 1  ! YawAngle
  Re_BufSz   = Re_BufSz   + 1  ! ElecPwr_prev
  Re_BufSz   = Re_BufSz   + 1  ! GenTrq_prev
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( ALLOCATED(InData%BlPitch) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitch))-1 ) =  PACK(InData%BlPitch ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitch)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%Yaw )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawRate )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSS_Spd )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSS_Spd )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%RotSpeed )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ExternalYawPosCom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ExternalYawRateCom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(InData%ExternalBlPitchCom) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%ExternalBlPitchCom))-1 ) =  PACK(InData%ExternalBlPitchCom ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%ExternalBlPitchCom)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ExternalGenTrq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ExternalElecPwr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ExternalHSSBrFrac )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%TwrAccel )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawErr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%WindDir )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%RootMyc))-1 ) =  PACK(InData%RootMyc ,.TRUE.)
  Re_Xferred   = Re_Xferred   + SIZE(InData%RootMyc)
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawBrTAxp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawBrTAyp )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSSTipPxa )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%RootMxc))-1 ) =  PACK(InData%RootMxc ,.TRUE.)
  Re_Xferred   = Re_Xferred   + SIZE(InData%RootMxc)
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSSTipMya )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSSTipMza )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSSTipMys )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%LSSTipMzs )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawBrMyn )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawBrMzn )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NcIMURAxs )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NcIMURAys )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%NcIMURAzs )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%RotPwr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HorWindV )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawAngle )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ElecPwr_prev )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenTrq_prev )
  Re_Xferred   = Re_Xferred   + 1
 END SUBROUTINE SrvD_PackInput

 SUBROUTINE SrvD_UnPackInput( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_inputtype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  IF ( ALLOCATED(OutData%BlPitch) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitch,1))); mask1 = .TRUE.
    OutData%BlPitch = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitch))-1 ),mask1,OutData%BlPitch)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitch)
  ENDIF
  OutData%Yaw = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawRate = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%LSS_Spd = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%HSS_Spd = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%RotSpeed = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ExternalYawPosCom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ExternalYawRateCom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(OutData%ExternalBlPitchCom) ) THEN
  ALLOCATE(mask1(SIZE(OutData%ExternalBlPitchCom,1))); mask1 = .TRUE.
    OutData%ExternalBlPitchCom = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%ExternalBlPitchCom))-1 ),mask1,OutData%ExternalBlPitchCom)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%ExternalBlPitchCom)
  ENDIF
  OutData%ExternalGenTrq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ExternalElecPwr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ExternalHSSBrFrac = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%TwrAccel = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawErr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%WindDir = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  ALLOCATE(mask1(SIZE(OutData%RootMyc,1))); mask1 = .TRUE.
  OutData%RootMyc = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%RootMyc))-1 ),mask1,OutData%RootMyc)
  DEALLOCATE(mask1)
  Re_Xferred   = Re_Xferred   + SIZE(OutData%RootMyc)
  OutData%YawBrTAxp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawBrTAyp = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%LSSTipPxa = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  ALLOCATE(mask1(SIZE(OutData%RootMxc,1))); mask1 = .TRUE.
  OutData%RootMxc = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%RootMxc))-1 ),mask1,OutData%RootMxc)
  DEALLOCATE(mask1)
  Re_Xferred   = Re_Xferred   + SIZE(OutData%RootMxc)
  OutData%LSSTipMya = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%LSSTipMza = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%LSSTipMys = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%LSSTipMzs = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawBrMyn = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawBrMzn = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NcIMURAxs = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NcIMURAys = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%NcIMURAzs = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%RotPwr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%HorWindV = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%YawAngle = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ElecPwr_prev = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenTrq_prev = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackInput

 SUBROUTINE SrvD_CopyOutput( SrcOutputData, DstOutputData, CtrlCode, ErrStat, ErrMsg )
   TYPE(SrvD_outputtype), INTENT(INOUT) :: SrcOutputData
   TYPE(SrvD_outputtype), INTENT(INOUT) :: DstOutputData
   INTEGER(IntKi),  INTENT(IN   ) :: CtrlCode
   INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
   CHARACTER(*),    INTENT(  OUT) :: ErrMsg
! Local 
   INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5,j,k
! 
   ErrStat = ErrID_None
   ErrMsg  = ""
IF (ALLOCATED(SrcOutputData%WriteOutput)) THEN
   i1 = SIZE(SrcOutputData%WriteOutput,1)
   IF (.NOT.ALLOCATED(DstOutputData%WriteOutput)) THEN 
      ALLOCATE(DstOutputData%WriteOutput(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOutput: Error allocating DstOutputData%WriteOutput.'
         RETURN
      END IF
   END IF
   DstOutputData%WriteOutput = SrcOutputData%WriteOutput
ENDIF
IF (ALLOCATED(SrcOutputData%BlPitchCom)) THEN
   i1 = SIZE(SrcOutputData%BlPitchCom,1)
   IF (.NOT.ALLOCATED(DstOutputData%BlPitchCom)) THEN 
      ALLOCATE(DstOutputData%BlPitchCom(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOutput: Error allocating DstOutputData%BlPitchCom.'
         RETURN
      END IF
   END IF
   DstOutputData%BlPitchCom = SrcOutputData%BlPitchCom
ENDIF
   DstOutputData%YawMom = SrcOutputData%YawMom
   DstOutputData%GenTrq = SrcOutputData%GenTrq
   DstOutputData%HSSBrTrq = SrcOutputData%HSSBrTrq
   DstOutputData%ElecPwr = SrcOutputData%ElecPwr
IF (ALLOCATED(SrcOutputData%TBDrCon)) THEN
   i1 = SIZE(SrcOutputData%TBDrCon,1)
   IF (.NOT.ALLOCATED(DstOutputData%TBDrCon)) THEN 
      ALLOCATE(DstOutputData%TBDrCon(i1),STAT=ErrStat)
      IF (ErrStat /= 0) THEN 
         ErrStat = ErrID_Fatal 
         ErrMsg = 'SrvD_CopyOutput: Error allocating DstOutputData%TBDrCon.'
         RETURN
      END IF
   END IF
   DstOutputData%TBDrCon = SrcOutputData%TBDrCon
ENDIF
 END SUBROUTINE SrvD_CopyOutput

 SUBROUTINE SrvD_DestroyOutput( OutputData, ErrStat, ErrMsg )
  TYPE(SrvD_outputtype), INTENT(INOUT) :: OutputData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5 
! 
  ErrStat = ErrID_None
  ErrMsg  = ""
  IF ( ALLOCATED(OutputData%WriteOutput) ) DEALLOCATE(OutputData%WriteOutput)
  IF ( ALLOCATED(OutputData%BlPitchCom) ) DEALLOCATE(OutputData%BlPitchCom)
  IF ( ALLOCATED(OutputData%TBDrCon) ) DEALLOCATE(OutputData%TBDrCon)
 END SUBROUTINE SrvD_DestroyOutput

 SUBROUTINE SrvD_PackOutput( ReKiBuf, DbKiBuf, IntKiBuf, Indata, ErrStat, ErrMsg, SizeOnly )
  REAL(ReKi),       ALLOCATABLE, INTENT(  OUT) :: ReKiBuf(:)
  REAL(DbKi),       ALLOCATABLE, INTENT(  OUT) :: DbKiBuf(:)
  INTEGER(IntKi),   ALLOCATABLE, INTENT(  OUT) :: IntKiBuf(:)
  TYPE(SrvD_outputtype),  INTENT(INOUT) :: InData
  INTEGER(IntKi),   INTENT(  OUT) :: ErrStat
  CHARACTER(*),     INTENT(  OUT) :: ErrMsg
  LOGICAL,OPTIONAL, INTENT(IN   ) :: SizeOnly
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i,i1,i2,i3,i4,i5     
  LOGICAL                        :: OnlySize ! if present and true, do not pack, just allocate buffers
 ! buffers to store meshes, if any
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  Re_BufSz    = Re_BufSz    + SIZE( InData%WriteOutput )  ! WriteOutput 
  Re_BufSz    = Re_BufSz    + SIZE( InData%BlPitchCom )  ! BlPitchCom 
  Re_BufSz   = Re_BufSz   + 1  ! YawMom
  Re_BufSz   = Re_BufSz   + 1  ! GenTrq
  Re_BufSz   = Re_BufSz   + 1  ! HSSBrTrq
  Re_BufSz   = Re_BufSz   + 1  ! ElecPwr
  Re_BufSz    = Re_BufSz    + SIZE( InData%TBDrCon )  ! TBDrCon 
  IF ( Re_BufSz  .GT. 0 ) ALLOCATE( ReKiBuf(  Re_BufSz  ) )
  IF ( Db_BufSz  .GT. 0 ) ALLOCATE( DbKiBuf(  Db_BufSz  ) )
  IF ( Int_BufSz .GT. 0 ) ALLOCATE( IntKiBuf( Int_BufSz ) )
  IF ( ALLOCATED(InData%WriteOutput) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%WriteOutput))-1 ) =  PACK(InData%WriteOutput ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%WriteOutput)
  ENDIF
  IF ( ALLOCATED(InData%BlPitchCom) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%BlPitchCom))-1 ) =  PACK(InData%BlPitchCom ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%BlPitchCom)
  ENDIF
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%YawMom )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%GenTrq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%HSSBrTrq )
  Re_Xferred   = Re_Xferred   + 1
  IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(1)-1 ) =  (InData%ElecPwr )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(InData%TBDrCon) ) THEN
    IF ( .NOT. OnlySize ) ReKiBuf ( Re_Xferred:Re_Xferred+(SIZE(InData%TBDrCon))-1 ) =  PACK(InData%TBDrCon ,.TRUE.)
    Re_Xferred   = Re_Xferred   + SIZE(InData%TBDrCon)
  ENDIF
 END SUBROUTINE SrvD_PackOutput

 SUBROUTINE SrvD_UnPackOutput( ReKiBuf, DbKiBuf, IntKiBuf, Outdata, ErrStat, ErrMsg )
  REAL(ReKi),      ALLOCATABLE, INTENT(IN   ) :: ReKiBuf(:)
  REAL(DbKi),      ALLOCATABLE, INTENT(IN   ) :: DbKiBuf(:)
  INTEGER(IntKi),  ALLOCATABLE, INTENT(IN   ) :: IntKiBuf(:)
  TYPE(SrvD_outputtype), INTENT(INOUT) :: OutData
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  INTEGER(IntKi)                 :: Re_BufSz
  INTEGER(IntKi)                 :: Re_Xferred
  INTEGER(IntKi)                 :: Re_CurrSz
  INTEGER(IntKi)                 :: Db_BufSz
  INTEGER(IntKi)                 :: Db_Xferred
  INTEGER(IntKi)                 :: Db_CurrSz
  INTEGER(IntKi)                 :: Int_BufSz
  INTEGER(IntKi)                 :: Int_Xferred
  INTEGER(IntKi)                 :: Int_CurrSz
  INTEGER(IntKi)                 :: i, i1, i2, i3, i4, i5
  LOGICAL, ALLOCATABLE           :: mask1(:)
  LOGICAL, ALLOCATABLE           :: mask2(:,:)
  LOGICAL, ALLOCATABLE           :: mask3(:,:,:)
  LOGICAL, ALLOCATABLE           :: mask4(:,:,:,:)
  LOGICAL, ALLOCATABLE           :: mask5(:,:,:,:,:)
 ! buffers to store meshes, if any
    !
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
  Re_BufSz  = 0
  Db_BufSz  = 0
  Int_BufSz  = 0
  IF ( ALLOCATED(OutData%WriteOutput) ) THEN
  ALLOCATE(mask1(SIZE(OutData%WriteOutput,1))); mask1 = .TRUE.
    OutData%WriteOutput = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%WriteOutput))-1 ),mask1,OutData%WriteOutput)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%WriteOutput)
  ENDIF
  IF ( ALLOCATED(OutData%BlPitchCom) ) THEN
  ALLOCATE(mask1(SIZE(OutData%BlPitchCom,1))); mask1 = .TRUE.
    OutData%BlPitchCom = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%BlPitchCom))-1 ),mask1,OutData%BlPitchCom)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%BlPitchCom)
  ENDIF
  OutData%YawMom = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%GenTrq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%HSSBrTrq = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  OutData%ElecPwr = ReKiBuf ( Re_Xferred )
  Re_Xferred   = Re_Xferred   + 1
  IF ( ALLOCATED(OutData%TBDrCon) ) THEN
  ALLOCATE(mask1(SIZE(OutData%TBDrCon,1))); mask1 = .TRUE.
    OutData%TBDrCon = UNPACK(ReKiBuf( Re_Xferred:Re_Xferred+(SIZE(OutData%TBDrCon))-1 ),mask1,OutData%TBDrCon)
  DEALLOCATE(mask1)
    Re_Xferred   = Re_Xferred   + SIZE(OutData%TBDrCon)
  ENDIF
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPackOutput

 SUBROUTINE SrvD_Pack( Re_RetAry, Db_RetAry, Int_RetAry, &
                     InData, ParamData, ContStateData, DiscStateData, &
                     ConstrStateData, OtherStateData, OutData, ErrStat, ErrMsg, &
                     SizeOnly )
  TYPE(SrvD_InputType),           INTENT(INOUT) :: InData
  TYPE(SrvD_ParameterType),       INTENT(INOUT) :: ParamData
  TYPE(SrvD_ContinuousStateType), INTENT(INOUT) :: ContStateData
  TYPE(SrvD_DiscreteStateType),   INTENT(INOUT) :: DiscStateData
  TYPE(SrvD_ConstraintStateType), INTENT(INOUT) :: ConstrStateData
  TYPE(SrvD_OtherStateType),      INTENT(INOUT) :: OtherStateData
  TYPE(SrvD_OutputType),          INTENT(INOUT) :: OutData
  REAL(ReKi), ALLOCATABLE,      INTENT(  OUT) :: Re_RetAry(:)
  REAL(DbKi), ALLOCATABLE,      INTENT(  OUT) :: Db_RetAry(:)
  INTEGER(IntKi), ALLOCATABLE,  INTENT(  OUT) :: Int_RetAry(:)
  INTEGER(IntKi),               INTENT(  OUT) :: ErrStat
  CHARACTER(*),                 INTENT(  OUT) :: ErrMsg
  LOGICAL, OPTIONAL,            INTENT(IN   ) :: SizeOnly
    ! Local variables
  REAL(ReKi), ALLOCATABLE                :: Re_Ary(:)
  REAL(DbKi), ALLOCATABLE                :: Db_Ary(:)
  INTEGER(IntKi), ALLOCATABLE            :: Int_Ary(:)
  INTEGER(IntKi)                         :: Re_BufSz
  INTEGER(IntKi)                         :: Re_Xferred
  INTEGER(IntKi)                         :: Re_CurrSz
  INTEGER(IntKi)                         :: Db_BufSz
  INTEGER(IntKi)                         :: Db_Xferred
  INTEGER(IntKi)                         :: Db_CurrSz
  INTEGER(IntKi)                         :: Int_BufSz
  INTEGER(IntKi)                         :: Int_Xferred
  INTEGER(IntKi)                         :: Int_CurrSz
  INTEGER(IntKi)                         :: ErrStat2
  CHARACTER(Len(ErrMsg))                 :: ErrMsg2
  LOGICAL                                :: OnlySize ! if present and true, do not pack, just allocate buffers
    ! Executable statements
  ErrStat = ErrID_None
  ErrMsg  = ""
  OnlySize = .FALSE.
  IF ( PRESENT(SizeOnly) ) THEN
    OnlySize = SizeOnly
  ENDIF
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
    ! Pack Input
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackInput(Re_Ary,Db_Ary,Int_Ary,InData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack Param
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackParam(Re_Ary,Db_Ary,Int_Ary,ParamData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack ContState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackContState(Re_Ary,Db_Ary,Int_Ary,ContStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack DiscState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackDiscState(Re_Ary,Db_Ary,Int_Ary,DiscStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack ConstrState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackConstrState(Re_Ary,Db_Ary,Int_Ary,ConstrStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack OtherState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOtherState(Re_Ary,Db_Ary,Int_Ary,OtherStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack Output
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOutput(Re_Ary,Db_Ary,Int_Ary,OutData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
  Re_Xferred  = Re_Xferred - 1
  Db_Xferred  = Db_Xferred - 1
  Int_Xferred  = Int_Xferred - 1
  IF ( ALLOCATED( Re_RetAry ) ) DEALLOCATE( Re_RetAry ) ;
  IF ( Re_Xferred .GT. 0) ALLOCATE( Re_RetAry( Re_Xferred ) ) ;
  IF ( ALLOCATED( Db_RetAry ) ) DEALLOCATE( Db_RetAry ) ;
  IF ( Db_Xferred .GT. 0) ALLOCATE( Db_RetAry( Db_Xferred ) ) ;
  IF ( ALLOCATED( Int_RetAry ) ) DEALLOCATE( Int_RetAry ) ;
  IF ( Int_Xferred .GT. 0) ALLOCATE( Int_RetAry( Int_Xferred ) ) ;
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
    ! Pack Input
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackInput(Re_Ary,Db_Ary,Int_Ary,InData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack Param
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackParam(Re_Ary,Db_Ary,Int_Ary,ParamData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack ContState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackContState(Re_Ary,Db_Ary,Int_Ary,ContStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack DiscState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackDiscState(Re_Ary,Db_Ary,Int_Ary,DiscStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack ConstrState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackConstrState(Re_Ary,Db_Ary,Int_Ary,ConstrStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack OtherState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOtherState(Re_Ary,Db_Ary,Int_Ary,OtherStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
    ! Pack Output
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOutput(Re_Ary,Db_Ary,Int_Ary,OutData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)=Re_Ary
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
    DEALLOCATE(Re_Ary)
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)=Db_Ary
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
    DEALLOCATE(Db_Ary)
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    IF ( .NOT. OnlySize ) Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)=Int_Ary
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
    DEALLOCATE(Int_Ary)
  ENDIF
  Re_Xferred   = Re_Xferred - 1
  Db_Xferred   = Db_Xferred - 1
  Int_Xferred  = Int_Xferred - 1
 END SUBROUTINE SrvD_Pack

 SUBROUTINE SrvD_UnPack( Re_RetAry, Db_RetAry, Int_RetAry, &
                     InData, ParamData, ContStateData, DiscStateData, &
                     ConstrStateData, OtherStateData, OutData, ErrStat, ErrMsg )
  TYPE(SrvD_InputType),           INTENT(INOUT) :: InData
  TYPE(SrvD_ParameterType),       INTENT(INOUT) :: ParamData
  TYPE(SrvD_ContinuousStateType), INTENT(INOUT) :: ContStateData
  TYPE(SrvD_DiscreteStateType),   INTENT(INOUT) :: DiscStateData
  TYPE(SrvD_ConstraintStateType), INTENT(INOUT) :: ConstrStateData
  TYPE(SrvD_OtherStateType),      INTENT(INOUT) :: OtherStateData
  TYPE(SrvD_OutputType),          INTENT(INOUT) :: OutData
  REAL(ReKi), ALLOCATABLE,      INTENT(IN   ) :: Re_RetAry(:)
  REAL(DbKi), ALLOCATABLE,      INTENT(IN   ) :: Db_RetAry(:)
  INTEGER(IntKi), ALLOCATABLE,   INTENT(IN   ) :: Int_RetAry(:)
  INTEGER(IntKi),  INTENT(  OUT) :: ErrStat
  CHARACTER(*),    INTENT(  OUT) :: ErrMsg
    ! Local variables
  REAL(ReKi), ALLOCATABLE                :: Re_Ary(:)
  REAL(DbKi), ALLOCATABLE                :: Db_Ary(:)
  INTEGER(IntKi), ALLOCATABLE            :: Int_Ary(:)
  INTEGER(IntKi)                         :: Re_BufSz
  INTEGER(IntKi)                         :: Re_Xferred
  INTEGER(IntKi)                         :: Re_CurrSz
  INTEGER(IntKi)                         :: Db_BufSz
  INTEGER(IntKi)                         :: Db_Xferred
  INTEGER(IntKi)                         :: Db_CurrSz
  INTEGER(IntKi)                         :: Int_BufSz
  INTEGER(IntKi)                         :: Int_Xferred
  INTEGER(IntKi)                         :: Int_CurrSz
  INTEGER(IntKi)                         :: ErrStat2
  CHARACTER(Len(ErrMsg))                 :: ErrMsg2
  ErrStat = ErrID_None
  ErrMsg  = ""
  Re_Xferred  = 1
  Db_Xferred  = 1
  Int_Xferred  = 1
    ! UnPack Input
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackInput(Re_Ary,Db_Ary,Int_Ary,InData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackInput(Re_Ary,Db_Ary,Int_Ary,InData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack Param
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackParam(Re_Ary,Db_Ary,Int_Ary,ParamData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackParam(Re_Ary,Db_Ary,Int_Ary,ParamData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack ContState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackContState(Re_Ary,Db_Ary,Int_Ary,ContStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackContState(Re_Ary,Db_Ary,Int_Ary,ContStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack DiscState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackDiscState(Re_Ary,Db_Ary,Int_Ary,DiscStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackDiscState(Re_Ary,Db_Ary,Int_Ary,DiscStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack ConstrState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackConstrState(Re_Ary,Db_Ary,Int_Ary,ConstrStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackConstrState(Re_Ary,Db_Ary,Int_Ary,ConstrStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack OtherState
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOtherState(Re_Ary,Db_Ary,Int_Ary,OtherStateData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackOtherState(Re_Ary,Db_Ary,Int_Ary,OtherStateData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
    ! UnPack Output
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  CALL SrvD_PackOutput(Re_Ary,Db_Ary,Int_Ary,OutData,ErrStat2,ErrMsg2,SizeOnly=.TRUE.)
  IF ( ALLOCATED( Re_Ary ) ) THEN
    Re_Ary = Re_RetAry(Re_Xferred:Re_Xferred+SIZE(Re_Ary)-1)
    Re_Xferred = Re_Xferred + SIZE( Re_Ary )
  ENDIF
  IF ( ALLOCATED( Db_Ary ) ) THEN
    DB_Ary = Db_RetAry(Db_Xferred:Db_Xferred+SIZE(Db_Ary)-1)
    Db_Xferred = Db_Xferred + SIZE( Db_Ary )
  ENDIF
  IF ( ALLOCATED( Int_Ary ) ) THEN
    Int_Ary = Int_RetAry(Int_Xferred:Int_Xferred+SIZE(Int_Ary)-1)
    Int_Xferred = Int_Xferred + SIZE( Int_Ary )
  ENDIF
  CALL SrvD_UnPackOutput(Re_Ary,Db_Ary,Int_Ary,OutData,ErrStat2,ErrMsg2)
  IF ( ALLOCATED( Re_Ary ) )  DEALLOCATE(Re_Ary)
  IF ( ALLOCATED( Db_Ary ) )  DEALLOCATE(Db_Ary)
  IF ( ALLOCATED( Int_Ary ) )  DEALLOCATE(Int_Ary)
  Re_Xferred   = Re_Xferred-1
  Db_Xferred   = Db_Xferred-1
  Int_Xferred  = Int_Xferred-1
 END SUBROUTINE SrvD_UnPack


 SUBROUTINE SrvD_Input_ExtrapInterp(u, tin, u_out, tin_out, ErrStat, ErrMsg )
!
! This subroutine calculates a extrapolated (or interpolated) input u_out at time t_out, from previous/future time
! values of u (which has values associated with times in t).  Order of the interpolation is given by the size of u
!
!  expressions below based on either
!
!  f(t) = a
!  f(t) = a + b * t, or
!  f(t) = a + b * t + c * t**2
!
!  where a, b and c are determined as the solution to
!  f(t1) = u1, f(t2) = u2, f(t3) = u3  (as appropriate)
!
!..................................................................................................................................

 TYPE(SrvD_inputtype), INTENT(INOUT)  :: u(:)      ! Inputs at t1 > t2 > t3
 REAL(DbKi),         INTENT(IN   )  :: tin(:)      ! Times associated with the inputs
 TYPE(SrvD_inputtype), INTENT(INOUT)  :: u_out     ! Inputs at tin_out
 REAL(DbKi),         INTENT(IN   )  :: tin_out     ! time to be extrap/interp'd to
 INTEGER(IntKi),     INTENT(  OUT)  :: ErrStat   ! Error status of the operation
 CHARACTER(*),       INTENT(  OUT)  :: ErrMsg    ! Error message if ErrStat /= ErrID_None
   ! local variables
 REAL(DbKi) :: t(SIZE(tin))    ! Times associated with the inputs
 REAL(DbKi) :: t_out           ! Time to which to be extrap/interpd
 TYPE(MeshType) :: tmpmesh
 INTEGER(IntKi)                 :: order    ! order of polynomial fit (max 2)
 REAL(DbKi)                                 :: b0       ! temporary for extrapolation/interpolation
 REAL(DbKi)                                 :: c0       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:)        :: b1       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:)        :: c1       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:)      :: b2       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:)      :: c2       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:)    :: b3       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:)    :: c3       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:)  :: b4       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:)  :: c4       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:,:):: b5       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:,:):: c5       ! temporary for extrapolation/interpolation
 INTEGER                                    :: i01    ! dim1 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i11    ! dim1 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i21    ! dim1 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i31    ! dim1 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i41    ! dim1 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i51    ! dim1 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i61    ! dim1 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i71    ! dim1 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i81    ! dim1 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i91    ! dim1 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i02    ! dim2 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i12    ! dim2 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i22    ! dim2 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i32    ! dim2 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i42    ! dim2 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i52    ! dim2 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i62    ! dim2 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i72    ! dim2 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i82    ! dim2 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i92    ! dim2 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i03    ! dim3 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i13    ! dim3 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i23    ! dim3 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i33    ! dim3 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i43    ! dim3 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i53    ! dim3 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i63    ! dim3 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i73    ! dim3 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i83    ! dim3 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i93    ! dim3 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i04    ! dim4 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i14    ! dim4 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i24    ! dim4 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i34    ! dim4 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i44    ! dim4 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i54    ! dim4 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i64    ! dim4 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i74    ! dim4 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i84    ! dim4 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i94    ! dim4 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i05    ! dim5 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i15    ! dim5 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i25    ! dim5 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i35    ! dim5 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i45    ! dim5 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i55    ! dim5 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i65    ! dim5 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i75    ! dim5 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i85    ! dim5 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i95    ! dim5 level 9 counter variable for arrays of ddts
    ! Initialize ErrStat
 ErrStat = ErrID_None
 ErrMsg  = ""
    ! we'll subtract a constant from the times to resolve some 
    ! numerical issues when t gets large (and to simplify the equations)
 t = tin - tin(1)
 t_out = tin_out - tin(1)

 if ( size(t) .ne. size(u)) then
    ErrStat = ErrID_Fatal
    ErrMsg = ' Error in SrvD_Input_ExtrapInterp: size(t) must equal size(u) '
    RETURN
 endif
 if (size(u) .gt. 3) then
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Input_ExtrapInterp: size(u) must be less than 4 '
    RETURN
 endif
 order = SIZE(u) - 1
 IF ( order .eq. 0 ) THEN
  u_out%BlPitch = u(1)%BlPitch
  u_out%Yaw = u(1)%Yaw
  u_out%YawRate = u(1)%YawRate
  u_out%LSS_Spd = u(1)%LSS_Spd
  u_out%HSS_Spd = u(1)%HSS_Spd
  u_out%RotSpeed = u(1)%RotSpeed
  u_out%ExternalYawPosCom = u(1)%ExternalYawPosCom
  u_out%ExternalYawRateCom = u(1)%ExternalYawRateCom
  u_out%ExternalBlPitchCom = u(1)%ExternalBlPitchCom
  u_out%ExternalGenTrq = u(1)%ExternalGenTrq
  u_out%ExternalElecPwr = u(1)%ExternalElecPwr
  u_out%ExternalHSSBrFrac = u(1)%ExternalHSSBrFrac
  u_out%TwrAccel = u(1)%TwrAccel
  u_out%YawErr = u(1)%YawErr
  u_out%WindDir = u(1)%WindDir
  u_out%RootMyc = u(1)%RootMyc
  u_out%YawBrTAxp = u(1)%YawBrTAxp
  u_out%YawBrTAyp = u(1)%YawBrTAyp
  u_out%LSSTipPxa = u(1)%LSSTipPxa
  u_out%RootMxc = u(1)%RootMxc
  u_out%LSSTipMya = u(1)%LSSTipMya
  u_out%LSSTipMza = u(1)%LSSTipMza
  u_out%LSSTipMys = u(1)%LSSTipMys
  u_out%LSSTipMzs = u(1)%LSSTipMzs
  u_out%YawBrMyn = u(1)%YawBrMyn
  u_out%YawBrMzn = u(1)%YawBrMzn
  u_out%NcIMURAxs = u(1)%NcIMURAxs
  u_out%NcIMURAys = u(1)%NcIMURAys
  u_out%NcIMURAzs = u(1)%NcIMURAzs
  u_out%RotPwr = u(1)%RotPwr
  u_out%HorWindV = u(1)%HorWindV
  u_out%YawAngle = u(1)%YawAngle
  u_out%ElecPwr_prev = u(1)%ElecPwr_prev
  u_out%GenTrq_prev = u(1)%GenTrq_prev
 ELSE IF ( order .eq. 1 ) THEN
  IF ( EqualRealNos( t(1), t(2) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Input_ExtrapInterp: t(1) must not equal t(2) to avoid a division-by-zero error.'
    RETURN
  END IF
  ALLOCATE(b1(SIZE(u_out%BlPitch,1)))
  ALLOCATE(c1(SIZE(u_out%BlPitch,1)))
  b1 = -(u(1)%BlPitch - u(2)%BlPitch)/t(2)
  u_out%BlPitch = u(1)%BlPitch + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = -(u(1)%Yaw - u(2)%Yaw)/t(2)
  u_out%Yaw = u(1)%Yaw + b0 * t_out
  b0 = -(u(1)%YawRate - u(2)%YawRate)/t(2)
  u_out%YawRate = u(1)%YawRate + b0 * t_out
  b0 = -(u(1)%LSS_Spd - u(2)%LSS_Spd)/t(2)
  u_out%LSS_Spd = u(1)%LSS_Spd + b0 * t_out
  b0 = -(u(1)%HSS_Spd - u(2)%HSS_Spd)/t(2)
  u_out%HSS_Spd = u(1)%HSS_Spd + b0 * t_out
  b0 = -(u(1)%RotSpeed - u(2)%RotSpeed)/t(2)
  u_out%RotSpeed = u(1)%RotSpeed + b0 * t_out
  b0 = -(u(1)%ExternalYawPosCom - u(2)%ExternalYawPosCom)/t(2)
  u_out%ExternalYawPosCom = u(1)%ExternalYawPosCom + b0 * t_out
  b0 = -(u(1)%ExternalYawRateCom - u(2)%ExternalYawRateCom)/t(2)
  u_out%ExternalYawRateCom = u(1)%ExternalYawRateCom + b0 * t_out
  ALLOCATE(b1(SIZE(u_out%ExternalBlPitchCom,1)))
  ALLOCATE(c1(SIZE(u_out%ExternalBlPitchCom,1)))
  b1 = -(u(1)%ExternalBlPitchCom - u(2)%ExternalBlPitchCom)/t(2)
  u_out%ExternalBlPitchCom = u(1)%ExternalBlPitchCom + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = -(u(1)%ExternalGenTrq - u(2)%ExternalGenTrq)/t(2)
  u_out%ExternalGenTrq = u(1)%ExternalGenTrq + b0 * t_out
  b0 = -(u(1)%ExternalElecPwr - u(2)%ExternalElecPwr)/t(2)
  u_out%ExternalElecPwr = u(1)%ExternalElecPwr + b0 * t_out
  b0 = -(u(1)%ExternalHSSBrFrac - u(2)%ExternalHSSBrFrac)/t(2)
  u_out%ExternalHSSBrFrac = u(1)%ExternalHSSBrFrac + b0 * t_out
  b0 = -(u(1)%TwrAccel - u(2)%TwrAccel)/t(2)
  u_out%TwrAccel = u(1)%TwrAccel + b0 * t_out
  b0 = -(u(1)%YawErr - u(2)%YawErr)/t(2)
  u_out%YawErr = u(1)%YawErr + b0 * t_out
  b0 = -(u(1)%WindDir - u(2)%WindDir)/t(2)
  u_out%WindDir = u(1)%WindDir + b0 * t_out
  ALLOCATE(b1(SIZE(u_out%RootMyc,1)))
  ALLOCATE(c1(SIZE(u_out%RootMyc,1)))
  b1 = -(u(1)%RootMyc - u(2)%RootMyc)/t(2)
  u_out%RootMyc = u(1)%RootMyc + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = -(u(1)%YawBrTAxp - u(2)%YawBrTAxp)/t(2)
  u_out%YawBrTAxp = u(1)%YawBrTAxp + b0 * t_out
  b0 = -(u(1)%YawBrTAyp - u(2)%YawBrTAyp)/t(2)
  u_out%YawBrTAyp = u(1)%YawBrTAyp + b0 * t_out
  b0 = -(u(1)%LSSTipPxa - u(2)%LSSTipPxa)/t(2)
  u_out%LSSTipPxa = u(1)%LSSTipPxa + b0 * t_out
  ALLOCATE(b1(SIZE(u_out%RootMxc,1)))
  ALLOCATE(c1(SIZE(u_out%RootMxc,1)))
  b1 = -(u(1)%RootMxc - u(2)%RootMxc)/t(2)
  u_out%RootMxc = u(1)%RootMxc + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = -(u(1)%LSSTipMya - u(2)%LSSTipMya)/t(2)
  u_out%LSSTipMya = u(1)%LSSTipMya + b0 * t_out
  b0 = -(u(1)%LSSTipMza - u(2)%LSSTipMza)/t(2)
  u_out%LSSTipMza = u(1)%LSSTipMza + b0 * t_out
  b0 = -(u(1)%LSSTipMys - u(2)%LSSTipMys)/t(2)
  u_out%LSSTipMys = u(1)%LSSTipMys + b0 * t_out
  b0 = -(u(1)%LSSTipMzs - u(2)%LSSTipMzs)/t(2)
  u_out%LSSTipMzs = u(1)%LSSTipMzs + b0 * t_out
  b0 = -(u(1)%YawBrMyn - u(2)%YawBrMyn)/t(2)
  u_out%YawBrMyn = u(1)%YawBrMyn + b0 * t_out
  b0 = -(u(1)%YawBrMzn - u(2)%YawBrMzn)/t(2)
  u_out%YawBrMzn = u(1)%YawBrMzn + b0 * t_out
  b0 = -(u(1)%NcIMURAxs - u(2)%NcIMURAxs)/t(2)
  u_out%NcIMURAxs = u(1)%NcIMURAxs + b0 * t_out
  b0 = -(u(1)%NcIMURAys - u(2)%NcIMURAys)/t(2)
  u_out%NcIMURAys = u(1)%NcIMURAys + b0 * t_out
  b0 = -(u(1)%NcIMURAzs - u(2)%NcIMURAzs)/t(2)
  u_out%NcIMURAzs = u(1)%NcIMURAzs + b0 * t_out
  b0 = -(u(1)%RotPwr - u(2)%RotPwr)/t(2)
  u_out%RotPwr = u(1)%RotPwr + b0 * t_out
  b0 = -(u(1)%HorWindV - u(2)%HorWindV)/t(2)
  u_out%HorWindV = u(1)%HorWindV + b0 * t_out
  b0 = -(u(1)%YawAngle - u(2)%YawAngle)/t(2)
  u_out%YawAngle = u(1)%YawAngle + b0 * t_out
  b0 = -(u(1)%ElecPwr_prev - u(2)%ElecPwr_prev)/t(2)
  u_out%ElecPwr_prev = u(1)%ElecPwr_prev + b0 * t_out
  b0 = -(u(1)%GenTrq_prev - u(2)%GenTrq_prev)/t(2)
  u_out%GenTrq_prev = u(1)%GenTrq_prev + b0 * t_out
 ELSE IF ( order .eq. 2 ) THEN
  IF ( EqualRealNos( t(1), t(2) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Input_ExtrapInterp: t(1) must not equal t(2) to avoid a division-by-zero error.'
    RETURN
  END IF
  IF ( EqualRealNos( t(2), t(3) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Input_ExtrapInterp: t(2) must not equal t(3) to avoid a division-by-zero error.'
    RETURN
  END IF
  IF ( EqualRealNos( t(1), t(3) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Input_ExtrapInterp: t(1) must not equal t(3) to avoid a division-by-zero error.'
    RETURN
  END IF
  ALLOCATE(b1(SIZE(u_out%BlPitch,1)))
  ALLOCATE(c1(SIZE(u_out%BlPitch,1)))
  b1 = (t(3)**2*(u(1)%BlPitch - u(2)%BlPitch) + t(2)**2*(-u(1)%BlPitch + u(3)%BlPitch))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%BlPitch + t(3)*u(2)%BlPitch - t(2)*u(3)%BlPitch ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%BlPitch = u(1)%BlPitch + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = (t(3)**2*(u(1)%Yaw - u(2)%Yaw) + t(2)**2*(-u(1)%Yaw + u(3)%Yaw))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%Yaw + t(3)*u(2)%Yaw - t(2)*u(3)%Yaw ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%Yaw = u(1)%Yaw + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawRate - u(2)%YawRate) + t(2)**2*(-u(1)%YawRate + u(3)%YawRate))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawRate + t(3)*u(2)%YawRate - t(2)*u(3)%YawRate ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawRate = u(1)%YawRate + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%LSS_Spd - u(2)%LSS_Spd) + t(2)**2*(-u(1)%LSS_Spd + u(3)%LSS_Spd))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSS_Spd + t(3)*u(2)%LSS_Spd - t(2)*u(3)%LSS_Spd ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSS_Spd = u(1)%LSS_Spd + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%HSS_Spd - u(2)%HSS_Spd) + t(2)**2*(-u(1)%HSS_Spd + u(3)%HSS_Spd))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%HSS_Spd + t(3)*u(2)%HSS_Spd - t(2)*u(3)%HSS_Spd ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%HSS_Spd = u(1)%HSS_Spd + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%RotSpeed - u(2)%RotSpeed) + t(2)**2*(-u(1)%RotSpeed + u(3)%RotSpeed))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%RotSpeed + t(3)*u(2)%RotSpeed - t(2)*u(3)%RotSpeed ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%RotSpeed = u(1)%RotSpeed + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ExternalYawPosCom - u(2)%ExternalYawPosCom) + t(2)**2*(-u(1)%ExternalYawPosCom + u(3)%ExternalYawPosCom))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ExternalYawPosCom + t(3)*u(2)%ExternalYawPosCom - t(2)*u(3)%ExternalYawPosCom ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalYawPosCom = u(1)%ExternalYawPosCom + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ExternalYawRateCom - u(2)%ExternalYawRateCom) + t(2)**2*(-u(1)%ExternalYawRateCom + u(3)%ExternalYawRateCom))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ExternalYawRateCom + t(3)*u(2)%ExternalYawRateCom - t(2)*u(3)%ExternalYawRateCom ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalYawRateCom = u(1)%ExternalYawRateCom + b0 * t_out + c0 * t_out**2
  ALLOCATE(b1(SIZE(u_out%ExternalBlPitchCom,1)))
  ALLOCATE(c1(SIZE(u_out%ExternalBlPitchCom,1)))
  b1 = (t(3)**2*(u(1)%ExternalBlPitchCom - u(2)%ExternalBlPitchCom) + t(2)**2*(-u(1)%ExternalBlPitchCom + u(3)%ExternalBlPitchCom))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%ExternalBlPitchCom + t(3)*u(2)%ExternalBlPitchCom - t(2)*u(3)%ExternalBlPitchCom ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalBlPitchCom = u(1)%ExternalBlPitchCom + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = (t(3)**2*(u(1)%ExternalGenTrq - u(2)%ExternalGenTrq) + t(2)**2*(-u(1)%ExternalGenTrq + u(3)%ExternalGenTrq))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ExternalGenTrq + t(3)*u(2)%ExternalGenTrq - t(2)*u(3)%ExternalGenTrq ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalGenTrq = u(1)%ExternalGenTrq + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ExternalElecPwr - u(2)%ExternalElecPwr) + t(2)**2*(-u(1)%ExternalElecPwr + u(3)%ExternalElecPwr))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ExternalElecPwr + t(3)*u(2)%ExternalElecPwr - t(2)*u(3)%ExternalElecPwr ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalElecPwr = u(1)%ExternalElecPwr + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ExternalHSSBrFrac - u(2)%ExternalHSSBrFrac) + t(2)**2*(-u(1)%ExternalHSSBrFrac + u(3)%ExternalHSSBrFrac))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ExternalHSSBrFrac + t(3)*u(2)%ExternalHSSBrFrac - t(2)*u(3)%ExternalHSSBrFrac ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ExternalHSSBrFrac = u(1)%ExternalHSSBrFrac + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%TwrAccel - u(2)%TwrAccel) + t(2)**2*(-u(1)%TwrAccel + u(3)%TwrAccel))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%TwrAccel + t(3)*u(2)%TwrAccel - t(2)*u(3)%TwrAccel ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%TwrAccel = u(1)%TwrAccel + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawErr - u(2)%YawErr) + t(2)**2*(-u(1)%YawErr + u(3)%YawErr))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawErr + t(3)*u(2)%YawErr - t(2)*u(3)%YawErr ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawErr = u(1)%YawErr + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%WindDir - u(2)%WindDir) + t(2)**2*(-u(1)%WindDir + u(3)%WindDir))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%WindDir + t(3)*u(2)%WindDir - t(2)*u(3)%WindDir ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%WindDir = u(1)%WindDir + b0 * t_out + c0 * t_out**2
  ALLOCATE(b1(SIZE(u_out%RootMyc,1)))
  ALLOCATE(c1(SIZE(u_out%RootMyc,1)))
  b1 = (t(3)**2*(u(1)%RootMyc - u(2)%RootMyc) + t(2)**2*(-u(1)%RootMyc + u(3)%RootMyc))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%RootMyc + t(3)*u(2)%RootMyc - t(2)*u(3)%RootMyc ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%RootMyc = u(1)%RootMyc + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = (t(3)**2*(u(1)%YawBrTAxp - u(2)%YawBrTAxp) + t(2)**2*(-u(1)%YawBrTAxp + u(3)%YawBrTAxp))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawBrTAxp + t(3)*u(2)%YawBrTAxp - t(2)*u(3)%YawBrTAxp ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawBrTAxp = u(1)%YawBrTAxp + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawBrTAyp - u(2)%YawBrTAyp) + t(2)**2*(-u(1)%YawBrTAyp + u(3)%YawBrTAyp))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawBrTAyp + t(3)*u(2)%YawBrTAyp - t(2)*u(3)%YawBrTAyp ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawBrTAyp = u(1)%YawBrTAyp + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%LSSTipPxa - u(2)%LSSTipPxa) + t(2)**2*(-u(1)%LSSTipPxa + u(3)%LSSTipPxa))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSSTipPxa + t(3)*u(2)%LSSTipPxa - t(2)*u(3)%LSSTipPxa ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSSTipPxa = u(1)%LSSTipPxa + b0 * t_out + c0 * t_out**2
  ALLOCATE(b1(SIZE(u_out%RootMxc,1)))
  ALLOCATE(c1(SIZE(u_out%RootMxc,1)))
  b1 = (t(3)**2*(u(1)%RootMxc - u(2)%RootMxc) + t(2)**2*(-u(1)%RootMxc + u(3)%RootMxc))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%RootMxc + t(3)*u(2)%RootMxc - t(2)*u(3)%RootMxc ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%RootMxc = u(1)%RootMxc + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = (t(3)**2*(u(1)%LSSTipMya - u(2)%LSSTipMya) + t(2)**2*(-u(1)%LSSTipMya + u(3)%LSSTipMya))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSSTipMya + t(3)*u(2)%LSSTipMya - t(2)*u(3)%LSSTipMya ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSSTipMya = u(1)%LSSTipMya + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%LSSTipMza - u(2)%LSSTipMza) + t(2)**2*(-u(1)%LSSTipMza + u(3)%LSSTipMza))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSSTipMza + t(3)*u(2)%LSSTipMza - t(2)*u(3)%LSSTipMza ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSSTipMza = u(1)%LSSTipMza + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%LSSTipMys - u(2)%LSSTipMys) + t(2)**2*(-u(1)%LSSTipMys + u(3)%LSSTipMys))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSSTipMys + t(3)*u(2)%LSSTipMys - t(2)*u(3)%LSSTipMys ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSSTipMys = u(1)%LSSTipMys + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%LSSTipMzs - u(2)%LSSTipMzs) + t(2)**2*(-u(1)%LSSTipMzs + u(3)%LSSTipMzs))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%LSSTipMzs + t(3)*u(2)%LSSTipMzs - t(2)*u(3)%LSSTipMzs ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%LSSTipMzs = u(1)%LSSTipMzs + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawBrMyn - u(2)%YawBrMyn) + t(2)**2*(-u(1)%YawBrMyn + u(3)%YawBrMyn))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawBrMyn + t(3)*u(2)%YawBrMyn - t(2)*u(3)%YawBrMyn ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawBrMyn = u(1)%YawBrMyn + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawBrMzn - u(2)%YawBrMzn) + t(2)**2*(-u(1)%YawBrMzn + u(3)%YawBrMzn))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawBrMzn + t(3)*u(2)%YawBrMzn - t(2)*u(3)%YawBrMzn ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawBrMzn = u(1)%YawBrMzn + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%NcIMURAxs - u(2)%NcIMURAxs) + t(2)**2*(-u(1)%NcIMURAxs + u(3)%NcIMURAxs))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%NcIMURAxs + t(3)*u(2)%NcIMURAxs - t(2)*u(3)%NcIMURAxs ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%NcIMURAxs = u(1)%NcIMURAxs + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%NcIMURAys - u(2)%NcIMURAys) + t(2)**2*(-u(1)%NcIMURAys + u(3)%NcIMURAys))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%NcIMURAys + t(3)*u(2)%NcIMURAys - t(2)*u(3)%NcIMURAys ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%NcIMURAys = u(1)%NcIMURAys + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%NcIMURAzs - u(2)%NcIMURAzs) + t(2)**2*(-u(1)%NcIMURAzs + u(3)%NcIMURAzs))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%NcIMURAzs + t(3)*u(2)%NcIMURAzs - t(2)*u(3)%NcIMURAzs ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%NcIMURAzs = u(1)%NcIMURAzs + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%RotPwr - u(2)%RotPwr) + t(2)**2*(-u(1)%RotPwr + u(3)%RotPwr))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%RotPwr + t(3)*u(2)%RotPwr - t(2)*u(3)%RotPwr ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%RotPwr = u(1)%RotPwr + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%HorWindV - u(2)%HorWindV) + t(2)**2*(-u(1)%HorWindV + u(3)%HorWindV))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%HorWindV + t(3)*u(2)%HorWindV - t(2)*u(3)%HorWindV ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%HorWindV = u(1)%HorWindV + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%YawAngle - u(2)%YawAngle) + t(2)**2*(-u(1)%YawAngle + u(3)%YawAngle))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawAngle + t(3)*u(2)%YawAngle - t(2)*u(3)%YawAngle ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawAngle = u(1)%YawAngle + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ElecPwr_prev - u(2)%ElecPwr_prev) + t(2)**2*(-u(1)%ElecPwr_prev + u(3)%ElecPwr_prev))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ElecPwr_prev + t(3)*u(2)%ElecPwr_prev - t(2)*u(3)%ElecPwr_prev ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ElecPwr_prev = u(1)%ElecPwr_prev + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%GenTrq_prev - u(2)%GenTrq_prev) + t(2)**2*(-u(1)%GenTrq_prev + u(3)%GenTrq_prev))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%GenTrq_prev + t(3)*u(2)%GenTrq_prev - t(2)*u(3)%GenTrq_prev ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%GenTrq_prev = u(1)%GenTrq_prev + b0 * t_out + c0 * t_out**2
 ELSE 
   ErrStat = ErrID_Fatal
   ErrMsg = ' order must be less than 3 in SrvD_Input_ExtrapInterp '
   RETURN
 ENDIF 
 END SUBROUTINE SrvD_Input_ExtrapInterp


 SUBROUTINE SrvD_Output_ExtrapInterp(u, tin, u_out, tin_out, ErrStat, ErrMsg )
!
! This subroutine calculates a extrapolated (or interpolated) input u_out at time t_out, from previous/future time
! values of u (which has values associated with times in t).  Order of the interpolation is given by the size of u
!
!  expressions below based on either
!
!  f(t) = a
!  f(t) = a + b * t, or
!  f(t) = a + b * t + c * t**2
!
!  where a, b and c are determined as the solution to
!  f(t1) = u1, f(t2) = u2, f(t3) = u3  (as appropriate)
!
!..................................................................................................................................

 TYPE(SrvD_outputtype), INTENT(INOUT)  :: u(:)      ! Inputs at t1 > t2 > t3
 REAL(DbKi),         INTENT(IN   )  :: tin(:)      ! Times associated with the inputs
 TYPE(SrvD_outputtype), INTENT(INOUT)  :: u_out     ! Inputs at tin_out
 REAL(DbKi),         INTENT(IN   )  :: tin_out     ! time to be extrap/interp'd to
 INTEGER(IntKi),     INTENT(  OUT)  :: ErrStat   ! Error status of the operation
 CHARACTER(*),       INTENT(  OUT)  :: ErrMsg    ! Error message if ErrStat /= ErrID_None
   ! local variables
 REAL(DbKi) :: t(SIZE(tin))    ! Times associated with the inputs
 REAL(DbKi) :: t_out           ! Time to which to be extrap/interpd
 TYPE(MeshType) :: tmpmesh
 INTEGER(IntKi)                 :: order    ! order of polynomial fit (max 2)
 REAL(DbKi)                                 :: b0       ! temporary for extrapolation/interpolation
 REAL(DbKi)                                 :: c0       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:)        :: b1       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:)        :: c1       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:)      :: b2       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:)      :: c2       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:)    :: b3       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:)    :: c3       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:)  :: b4       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:)  :: c4       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:,:):: b5       ! temporary for extrapolation/interpolation
 REAL(DbKi),ALLOCATABLE,DIMENSION(:,:,:,:,:):: c5       ! temporary for extrapolation/interpolation
 INTEGER                                    :: i01    ! dim1 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i11    ! dim1 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i21    ! dim1 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i31    ! dim1 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i41    ! dim1 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i51    ! dim1 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i61    ! dim1 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i71    ! dim1 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i81    ! dim1 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i91    ! dim1 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i02    ! dim2 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i12    ! dim2 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i22    ! dim2 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i32    ! dim2 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i42    ! dim2 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i52    ! dim2 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i62    ! dim2 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i72    ! dim2 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i82    ! dim2 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i92    ! dim2 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i03    ! dim3 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i13    ! dim3 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i23    ! dim3 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i33    ! dim3 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i43    ! dim3 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i53    ! dim3 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i63    ! dim3 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i73    ! dim3 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i83    ! dim3 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i93    ! dim3 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i04    ! dim4 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i14    ! dim4 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i24    ! dim4 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i34    ! dim4 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i44    ! dim4 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i54    ! dim4 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i64    ! dim4 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i74    ! dim4 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i84    ! dim4 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i94    ! dim4 level 9 counter variable for arrays of ddts
 INTEGER                                    :: i05    ! dim5 level 0 counter variable for arrays of ddts
 INTEGER                                    :: i15    ! dim5 level 1 counter variable for arrays of ddts
 INTEGER                                    :: i25    ! dim5 level 2 counter variable for arrays of ddts
 INTEGER                                    :: i35    ! dim5 level 3 counter variable for arrays of ddts
 INTEGER                                    :: i45    ! dim5 level 4 counter variable for arrays of ddts
 INTEGER                                    :: i55    ! dim5 level 5 counter variable for arrays of ddts
 INTEGER                                    :: i65    ! dim5 level 6 counter variable for arrays of ddts
 INTEGER                                    :: i75    ! dim5 level 7 counter variable for arrays of ddts
 INTEGER                                    :: i85    ! dim5 level 8 counter variable for arrays of ddts
 INTEGER                                    :: i95    ! dim5 level 9 counter variable for arrays of ddts
    ! Initialize ErrStat
 ErrStat = ErrID_None
 ErrMsg  = ""
    ! we'll subtract a constant from the times to resolve some 
    ! numerical issues when t gets large (and to simplify the equations)
 t = tin - tin(1)
 t_out = tin_out - tin(1)

 if ( size(t) .ne. size(u)) then
    ErrStat = ErrID_Fatal
    ErrMsg = ' Error in SrvD_Output_ExtrapInterp: size(t) must equal size(u) '
    RETURN
 endif
 if (size(u) .gt. 3) then
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Output_ExtrapInterp: size(u) must be less than 4 '
    RETURN
 endif
 order = SIZE(u) - 1
 IF ( order .eq. 0 ) THEN
  u_out%WriteOutput = u(1)%WriteOutput
  u_out%BlPitchCom = u(1)%BlPitchCom
  u_out%YawMom = u(1)%YawMom
  u_out%GenTrq = u(1)%GenTrq
  u_out%HSSBrTrq = u(1)%HSSBrTrq
  u_out%ElecPwr = u(1)%ElecPwr
  u_out%TBDrCon = u(1)%TBDrCon
 ELSE IF ( order .eq. 1 ) THEN
  IF ( EqualRealNos( t(1), t(2) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Output_ExtrapInterp: t(1) must not equal t(2) to avoid a division-by-zero error.'
    RETURN
  END IF
  ALLOCATE(b1(SIZE(u_out%WriteOutput,1)))
  ALLOCATE(c1(SIZE(u_out%WriteOutput,1)))
  b1 = -(u(1)%WriteOutput - u(2)%WriteOutput)/t(2)
  u_out%WriteOutput = u(1)%WriteOutput + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  ALLOCATE(b1(SIZE(u_out%BlPitchCom,1)))
  ALLOCATE(c1(SIZE(u_out%BlPitchCom,1)))
  b1 = -(u(1)%BlPitchCom - u(2)%BlPitchCom)/t(2)
  u_out%BlPitchCom = u(1)%BlPitchCom + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = -(u(1)%YawMom - u(2)%YawMom)/t(2)
  u_out%YawMom = u(1)%YawMom + b0 * t_out
  b0 = -(u(1)%GenTrq - u(2)%GenTrq)/t(2)
  u_out%GenTrq = u(1)%GenTrq + b0 * t_out
  b0 = -(u(1)%HSSBrTrq - u(2)%HSSBrTrq)/t(2)
  u_out%HSSBrTrq = u(1)%HSSBrTrq + b0 * t_out
  b0 = -(u(1)%ElecPwr - u(2)%ElecPwr)/t(2)
  u_out%ElecPwr = u(1)%ElecPwr + b0 * t_out
  ALLOCATE(b1(SIZE(u_out%TBDrCon,1)))
  ALLOCATE(c1(SIZE(u_out%TBDrCon,1)))
  b1 = -(u(1)%TBDrCon - u(2)%TBDrCon)/t(2)
  u_out%TBDrCon = u(1)%TBDrCon + b1 * t_out
  DEALLOCATE(b1)
  DEALLOCATE(c1)
 ELSE IF ( order .eq. 2 ) THEN
  IF ( EqualRealNos( t(1), t(2) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Output_ExtrapInterp: t(1) must not equal t(2) to avoid a division-by-zero error.'
    RETURN
  END IF
  IF ( EqualRealNos( t(2), t(3) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Output_ExtrapInterp: t(2) must not equal t(3) to avoid a division-by-zero error.'
    RETURN
  END IF
  IF ( EqualRealNos( t(1), t(3) ) ) THEN
    ErrStat = ErrID_Fatal
    ErrMsg  = ' Error in SrvD_Output_ExtrapInterp: t(1) must not equal t(3) to avoid a division-by-zero error.'
    RETURN
  END IF
  ALLOCATE(b1(SIZE(u_out%WriteOutput,1)))
  ALLOCATE(c1(SIZE(u_out%WriteOutput,1)))
  b1 = (t(3)**2*(u(1)%WriteOutput - u(2)%WriteOutput) + t(2)**2*(-u(1)%WriteOutput + u(3)%WriteOutput))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%WriteOutput + t(3)*u(2)%WriteOutput - t(2)*u(3)%WriteOutput ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%WriteOutput = u(1)%WriteOutput + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  ALLOCATE(b1(SIZE(u_out%BlPitchCom,1)))
  ALLOCATE(c1(SIZE(u_out%BlPitchCom,1)))
  b1 = (t(3)**2*(u(1)%BlPitchCom - u(2)%BlPitchCom) + t(2)**2*(-u(1)%BlPitchCom + u(3)%BlPitchCom))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%BlPitchCom + t(3)*u(2)%BlPitchCom - t(2)*u(3)%BlPitchCom ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%BlPitchCom = u(1)%BlPitchCom + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
  b0 = (t(3)**2*(u(1)%YawMom - u(2)%YawMom) + t(2)**2*(-u(1)%YawMom + u(3)%YawMom))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%YawMom + t(3)*u(2)%YawMom - t(2)*u(3)%YawMom ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%YawMom = u(1)%YawMom + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%GenTrq - u(2)%GenTrq) + t(2)**2*(-u(1)%GenTrq + u(3)%GenTrq))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%GenTrq + t(3)*u(2)%GenTrq - t(2)*u(3)%GenTrq ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%GenTrq = u(1)%GenTrq + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%HSSBrTrq - u(2)%HSSBrTrq) + t(2)**2*(-u(1)%HSSBrTrq + u(3)%HSSBrTrq))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%HSSBrTrq + t(3)*u(2)%HSSBrTrq - t(2)*u(3)%HSSBrTrq ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%HSSBrTrq = u(1)%HSSBrTrq + b0 * t_out + c0 * t_out**2
  b0 = (t(3)**2*(u(1)%ElecPwr - u(2)%ElecPwr) + t(2)**2*(-u(1)%ElecPwr + u(3)%ElecPwr))/(t(2)*t(3)*(t(2) - t(3)))
  c0 = ( (t(2)-t(3))*u(1)%ElecPwr + t(3)*u(2)%ElecPwr - t(2)*u(3)%ElecPwr ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%ElecPwr = u(1)%ElecPwr + b0 * t_out + c0 * t_out**2
  ALLOCATE(b1(SIZE(u_out%TBDrCon,1)))
  ALLOCATE(c1(SIZE(u_out%TBDrCon,1)))
  b1 = (t(3)**2*(u(1)%TBDrCon - u(2)%TBDrCon) + t(2)**2*(-u(1)%TBDrCon + u(3)%TBDrCon))/(t(2)*t(3)*(t(2) - t(3)))
  c1 = ( (t(2)-t(3))*u(1)%TBDrCon + t(3)*u(2)%TBDrCon - t(2)*u(3)%TBDrCon ) / (t(2)*t(3)*(t(2) - t(3)))
  u_out%TBDrCon = u(1)%TBDrCon + b1 * t_out + c1 * t_out**2
  DEALLOCATE(b1)
  DEALLOCATE(c1)
 ELSE 
   ErrStat = ErrID_Fatal
   ErrMsg = ' order must be less than 3 in SrvD_Output_ExtrapInterp '
   RETURN
 ENDIF 
 END SUBROUTINE SrvD_Output_ExtrapInterp

END MODULE ServoDyn_Types
!ENDOFREGISTRYGENERATEDFILE
